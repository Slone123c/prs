<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êñ∞Â¢ûË∞ÉÂ∫¶‰ªªÂä° - DCIMËøêÁª¥Á≥ªÁªü</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background-color: #f5f7fa;
            color: #333;
        }

        /* È°∂ÈÉ®ÂØºËà™Ê†è */
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0 20px;
            height: 60px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .navbar .logo {
            font-size: 18px;
            font-weight: 600;
            margin-right: 40px;
        }

        .navbar .nav-menu {
            display: flex;
            list-style: none;
        }

        .navbar .nav-item {
            margin-right: 30px;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .navbar .nav-item.active,
        .navbar .nav-item:hover {
            background-color: rgba(255,255,255,0.2);
        }

        /* ‰∏ªÂÜÖÂÆπÂå∫Âüü */
        .main-content {
            padding: 24px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* È°µÈù¢Ê†áÈ¢ò */
        .page-header {
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .back-btn {
            background: none;
            border: none;
            font-size: 20px;
            color: #667eea;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .back-btn:hover {
            background-color: rgba(102, 126, 234, 0.1);
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: #1f2937;
        }

        /* Ê≠•È™§Êù° */
        .steps-container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .steps {
            display: flex;
            justify-content: space-between;
            position: relative;
        }

        .steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: #e5e7eb;
            z-index: 1;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 8px;
            transition: all 0.3s;
        }

        .step.active .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .step.completed .step-number {
            background: #10b981;
            color: white;
        }

        .step:not(.active):not(.completed) .step-number {
            background: #e5e7eb;
            color: #6b7280;
        }

        .step-title {
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            color: #374151;
        }

        .step.active .step-title {
            color: #667eea;
            font-weight: 600;
        }

        /* Ë°®ÂçïÂÜÖÂÆπÂå∫Âüü */
        .form-container {
            background: white;
            border-radius: 8px;
            padding: 32px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }

        .form-section {
            margin-bottom: 32px;
        }

        .form-section:last-child {
            margin-bottom: 0;
        }

        .form-section-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f3f4f6;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-weight: 500;
            color: #374151;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .form-label .required {
            color: #ef4444;
        }

        .form-input, .form-select, .form-textarea {
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-help {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }

        .form-error {
            font-size: 12px;
            color: #ef4444;
            margin-top: 4px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }

        .checkbox-group label {
            font-size: 14px;
            color: #374151;
            cursor: pointer;
        }

        /* Êñá‰ª∂‰∏ä‰º† */
        .file-upload {
            border: 2px dashed #d1d5db;
            border-radius: 6px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .file-upload:hover {
            border-color: #667eea;
        }

        .file-upload.dragover {
            border-color: #667eea;
            background-color: rgba(102, 126, 234, 0.05);
        }

        .file-upload-text {
            color: #6b7280;
            margin-top: 8px;
        }

        .file-upload-icon {
            font-size: 24px;
            color: #9ca3af;
        }

        .uploaded-file {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f3f4f6;
            border-radius: 4px;
            margin-top: 8px;
        }

        .uploaded-file .remove-file {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            font-size: 16px;
        }

                 /* Ëß£ÊûêÊñáÊ°£Ê®°ÊÄÅÊ°Ü */
         .parse-status {
             text-align: center;
             padding: 20px;
         }

         .loading-icon, .success-icon, .error-icon {
             font-size: 48px;
             margin-bottom: 16px;
         }

         .loading-text, .success-text, .error-text {
             font-size: 16px;
             font-weight: 600;
             margin-bottom: 12px;
         }

         .loading-text {
             color: #6b7280;
         }

         .success-text {
             color: #10b981;
         }

         .error-text {
             color: #ef4444;
         }

         .parse-result {
             background: #f0f9ff;
             padding: 12px;
             border-radius: 6px;
             color: #0369a1;
             margin-top: 12px;
         }

         .error-reason {
             background: #fef2f2;
             padding: 12px;
             border-radius: 6px;
             color: #dc2626;
             margin: 12px 0;
             font-size: 14px;
         }

         .error-actions {
             margin-top: 12px;
             font-size: 14px;
             color: #6b7280;
         }

         .form-tips {
             background: #f8fafc;
             padding: 12px;
             border-radius: 6px;
             font-size: 14px;
             color: #6b7280;
             margin-bottom: 16px;
             border-left: 4px solid #667eea;
         }

 

        /* Â∫ïÈÉ®Êìç‰ΩúÊ†è */
        .form-actions {
            background: white;
            padding: 20px 32px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-outline {
            background: white;
            color: #667eea;
            border: 1px solid #667eea;
        }

        .btn-outline:hover {
            background: #667eea;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Ê®°ÊÄÅÊ°Ü */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: end;
            gap: 12px;
        }

                 /* ËÆæÂ§áË∞ÉÂ∫¶ÁÆ°ÁêÜÊ†∑Âºè */
         .operation-blocks-container {
             margin-top: 20px;
         }

         .operation-blocks-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 20px;
             padding: 16px;
             background: #f8fafc;
             border-radius: 8px;
             border: 1px solid #e5e7eb;
         }

         .blocks-info {
             display: flex;
             gap: 24px;
             font-size: 14px;
             color: #374151;
         }

         .blocks-info span {
             font-weight: 500;
         }

         .operation-block {
             background: #ffffff;
             border: 1px solid #e5e7eb;
             border-radius: 8px;
             margin-bottom: 20px;
             overflow: hidden;
         }

         .operation-block-header {
             background: #f8fafc;
             padding: 16px 20px;
             border-bottom: 1px solid #e5e7eb;
             display: flex;
             justify-content: space-between;
             align-items: center;
         }

         .block-title {
             font-size: 16px;
             font-weight: 600;
             color: #1f2937;
         }

         .block-actions {
             display: flex;
             gap: 8px;
         }

         .operation-block-content {
             padding: 20px;
         }

         .block-basic-info {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
             gap: 16px;
             margin-bottom: 20px;
             padding-bottom: 20px;
             border-bottom: 1px solid #f3f4f6;
         }

         .device-type-group {
             display: flex;
             gap: 12px;
             flex-wrap: wrap;
         }

         .checkbox-item {
             display: flex;
             align-items: center;
             gap: 6px;
             padding: 6px 12px;
             border: 1px solid #d1d5db;
             border-radius: 6px;
             cursor: pointer;
             transition: all 0.3s;
         }

         .checkbox-item:hover {
             border-color: #667eea;
             background-color: rgba(102, 126, 234, 0.05);
         }

         .checkbox-item.checked {
             border-color: #667eea;
             background-color: rgba(102, 126, 234, 0.1);
             color: #667eea;
         }

         .checkbox-item input[type="checkbox"] {
             margin: 0;
         }

         .devices-section {
             margin-top: 20px;
         }

         .devices-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 16px;
         }

         .devices-count {
             font-size: 14px;
             color: #6b7280;
         }

         .devices-table {
             border: 1px solid #e5e7eb;
             border-radius: 8px;
             overflow: hidden;
             background: white;
         }

         .devices-table table {
             width: 100%;
             border-collapse: collapse;
         }

         .devices-table th {
             background: #f8fafc;
             padding: 12px 8px;
             text-align: left;
             font-weight: 600;
             color: #374151;
             font-size: 13px;
             border-bottom: 1px solid #e5e7eb;
         }

         .devices-table td {
             padding: 8px;
             border-bottom: 1px solid #f3f4f6;
             vertical-align: middle;
         }

         .devices-table tbody tr:hover {
             background-color: #f9fafb;
         }

         .device-input {
             width: 100%;
             padding: 6px 8px;
             border: 1px solid #d1d5db;
             border-radius: 4px;
             font-size: 13px;
             outline: none;
         }

         .device-input:focus {
             border-color: #667eea;
             box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
         }

         .device-input:read-only {
             background-color: #f9fafb;
             color: #6b7280;
         }

         .device-select {
             width: 100%;
             padding: 6px 8px;
             border: 1px solid #d1d5db;
             border-radius: 4px;
             font-size: 13px;
             background: white;
             outline: none;
         }

         .device-select:focus {
             border-color: #667eea;
             box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
         }

         .remove-device-btn {
             background: #ef4444;
             color: white;
             border: none;
             padding: 4px 8px;
             border-radius: 4px;
             font-size: 12px;
             cursor: pointer;
         }

         .remove-device-btn:hover {
             background: #dc2626;
         }

         .add-device-btn {
             background: #10b981;
             color: white;
             border: none;
             padding: 8px 16px;
             border-radius: 6px;
             font-size: 14px;
             cursor: pointer;
             display: flex;
             align-items: center;
             gap: 6px;
         }

         .add-device-btn:hover {
             background: #059669;
         }

         .add-device-btn:disabled {
             background: #9ca3af;
             cursor: not-allowed;
         }

         .device-limit-warning {
             background: #fef3c7;
             color: #92400e;
             padding: 8px 12px;
             border-radius: 6px;
             font-size: 13px;
             margin-top: 8px;
         }

         .u-position-group {
             display: flex;
             gap: 8px;
             align-items: center;
         }

         .u-position-group .device-select {
             width: auto;
             min-width: 70px;
         }

         .auto-filled {
             background-color: #f0f9ff !important;
             color: #0369a1 !important;
         }

         .validation-error {
             border-color: #ef4444 !important;
             box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.1) !important;
         }

         .validation-message {
             font-size: 11px;
             color: #ef4444;
             margin-top: 2px;
         }

         /* ÈìæË∑ØÊãìÊâëË∞ÉÊï¥Ê†∑Âºè */
         .topology-blocks-container {
             margin-top: 20px;
         }

         .topology-blocks-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 20px;
             padding: 16px;
             background: #f8fafc;
             border-radius: 8px;
             border: 1px solid #e5e7eb;
         }

         .topology-block {
             background: #ffffff;
             border: 1px solid #e5e7eb;
             border-radius: 8px;
             margin-bottom: 20px;
             overflow: hidden;
         }

         .topology-block-header {
             background: #f8fafc;
             padding: 16px 20px;
             border-bottom: 1px solid #e5e7eb;
             display: flex;
             justify-content: space-between;
             align-items: center;
         }

         .links-section {
             margin-top: 20px;
         }

         .links-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 16px;
         }

         .links-count {
             font-size: 14px;
             color: #6b7280;
         }

         .links-actions {
             display: flex;
             gap: 12px;
             align-items: center;
         }



         .add-link-btn {
             background: #10b981;
             color: white;
             border: none;
             padding: 8px 16px;
             border-radius: 6px;
             font-size: 14px;
             cursor: pointer;
             display: flex;
             align-items: center;
             gap: 6px;
         }

         .add-link-btn:hover {
             background: #059669;
         }

         .add-link-btn:disabled {
             background: #9ca3af;
             cursor: not-allowed;
         }

         .link-limit-warning {
             background: #fef3c7;
             color: #92400e;
             padding: 8px 12px;
             border-radius: 6px;
             font-size: 13px;
             margin-top: 8px;
         }

         .links-container {
             display: flex;
             flex-direction: column;
             gap: 16px;
         }

         .link-card {
             border: 1px solid #e5e7eb;
             border-radius: 8px;
             background: white;
             overflow: hidden;
         }

         .link-card-header {
             background: #f8fafc;
             padding: 12px 16px;
             border-bottom: 1px solid #e5e7eb;
             display: flex;
             justify-content: space-between;
             align-items: center;
         }

         .link-card-title {
             font-weight: 600;
             color: #374151;
             font-size: 14px;
         }

         .link-card-actions {
             display: flex;
             gap: 8px;
         }

         .link-card-body {
             padding: 20px;
             display: grid;
             grid-template-columns: 1fr 1fr 1fr;
             gap: 20px;
         }

         @media (max-width: 1200px) {
             .link-card-body {
                 grid-template-columns: 1fr;
                 gap: 16px;
             }
             
             .link-card-header {
                 flex-direction: column;
                 align-items: flex-start;
                 gap: 10px;
             }
             
             .link-card-actions {
                 width: 100%;
                 justify-content: flex-end;
             }
         }

         .link-info-section {
             border: 1px solid #e5e7eb;
             border-radius: 6px;
             overflow: hidden;
         }

         .link-info-header {
             background: #f8fafc;
             padding: 12px 16px;
             border-bottom: 1px solid #e5e7eb;
             font-weight: 600;
             color: #374151;
             font-size: 13px;
         }

         .link-info-content {
             padding: 16px;
             display: flex;
             flex-direction: column;
             gap: 12px;
         }

         .link-field {
             display: flex;
             flex-direction: column;
             gap: 4px;
         }

         .link-field-label {
             font-size: 12px;
             color: #6b7280;
             font-weight: 500;
         }

         .link-field-label .required {
             color: #ef4444;
         }



         @keyframes spin {
             0% { transform: rotate(0deg); }
             100% { transform: rotate(360deg); }
         }

         .link-input {
             width: 100%;
             padding: 8px 12px;
             border: 1px solid #d1d5db;
             border-radius: 6px;
             font-size: 14px;
             outline: none;
             transition: all 0.2s ease;
         }

         .link-input:focus {
             border-color: #667eea;
             box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
         }

         .link-select {
             width: 100%;
             padding: 8px 12px;
             border: 1px solid #d1d5db;
             border-radius: 6px;
             font-size: 14px;
             background: white;
             outline: none;
             transition: all 0.2s ease;
         }

         .link-select:focus {
             border-color: #667eea;
             box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
         }

         .extra-config-btn {
             background: #0ea5e9;
             color: white;
             border: none;
             padding: 8px 12px;
             border-radius: 6px;
             font-size: 14px;
             cursor: pointer;
             transition: all 0.2s ease;
         }

         .extra-config-btn:hover {
             background: #0284c7;
         }

         .remove-link-btn {
             background: #ef4444;
             color: white;
             border: none;
             padding: 6px 12px;
             border-radius: 4px;
             font-size: 13px;
             cursor: pointer;
             transition: all 0.2s ease;
         }

         .remove-link-btn:hover {
             background: #dc2626;
         }

         .expand-edit-btn {
             background: #8b5cf6;
             color: white;
             border: none;
             padding: 6px 12px;
             border-radius: 4px;
             font-size: 13px;
             cursor: pointer;
             transition: all 0.2s ease;
         }

         .expand-edit-btn:hover {
             background: #7c3aed;
         }

         /* Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
         .modal {
             display: none;
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             background: rgba(0, 0, 0, 0.5);
             z-index: 1000;
         }

         .modal.show {
             display: flex;
             align-items: center;
             justify-content: center;
         }

         .modal-content {
             background: white;
             border-radius: 8px;
             max-width: 500px;
             width: 90%;
             max-height: 80vh;
             overflow-y: auto;
         }

         .modal-header {
             padding: 20px 24px 16px;
             border-bottom: 1px solid #e5e7eb;
             display: flex;
             justify-content: space-between;
             align-items: center;
         }

         .modal-title {
             font-size: 18px;
             font-weight: 600;
             color: #111827;
             margin: 0;
         }

         .modal-close {
             background: none;
             border: none;
             font-size: 24px;
             color: #6b7280;
             cursor: pointer;
             padding: 0;
             width: 24px;
             height: 24px;
             display: flex;
             align-items: center;
             justify-content: center;
         }

         .modal-close:hover {
             color: #374151;
         }

         .modal-body {
             padding: 20px 24px;
         }

         .modal-footer {
             padding: 16px 24px 20px;
             border-top: 1px solid #e5e7eb;
             display: flex;
             justify-content: flex-end;
             gap: 12px;
         }

         /* ÈìæË∑ØÁºñËæëÂºπÁ™óÊ†∑Âºè */
         .link-edit-modal {
             display: none;
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             background: rgba(0, 0, 0, 0.5);
             z-index: 1001;
             align-items: center;
             justify-content: center;
         }

         .link-edit-modal.show {
             display: flex;
         }

         .link-edit-modal-content {
             background: white;
             border-radius: 8px;
             width: 900px;
             max-width: 95vw;
             max-height: 90vh;
             overflow-y: auto;
             box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
         }

         .link-edit-modal-header {
             padding: 20px 24px 16px;
             border-bottom: 1px solid #e5e7eb;
             display: flex;
             justify-content: space-between;
             align-items: center;
         }

         .link-edit-modal-title {
             font-size: 16px;
             font-weight: 600;
             color: #111827;
             margin: 0;
         }

         .link-edit-modal-close {
             background: none;
             border: none;
             font-size: 24px;
             color: #6b7280;
             cursor: pointer;
             padding: 0;
             width: 24px;
             height: 24px;
             display: flex;
             align-items: center;
             justify-content: center;
         }

         .link-edit-modal-close:hover {
             color: #374151;
         }

         .link-edit-modal-body {
             padding: 24px;
         }

         .link-edit-container {
             display: grid;
             grid-template-columns: 1fr auto 1fr;
             gap: 24px;
             align-items: start;
         }

         .link-endpoint {
             border: 1px solid #e5e7eb;
             border-radius: 8px;
             overflow: hidden;
         }

         .endpoint-header {
             background: #f8fafc;
             padding: 12px 16px;
             border-bottom: 1px solid #e5e7eb;
             font-weight: 600;
             color: #374151;
             font-size: 14px;
         }

         .endpoint-content {
             padding: 20px;
             display: flex;
             flex-direction: column;
             gap: 16px;
         }

         .endpoint-field {
             display: flex;
             flex-direction: column;
             gap: 6px;
         }

         .endpoint-label {
             font-size: 14px;
             color: #374151;
             font-weight: 500;
         }

         .endpoint-input {
             width: 100%;
             padding: 8px 12px;
             border: 1px solid #d1d5db;
             border-radius: 6px;
             font-size: 14px;
             outline: none;
             transition: all 0.2s ease;
         }

         .endpoint-input:focus {
             border-color: #667eea;
             box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
         }

         .radio-group {
             display: flex;
             gap: 16px;
         }

         .radio-option {
             display: flex;
             align-items: center;
             gap: 6px;
             cursor: pointer;
         }

         .radio-option input[type="radio"] {
             margin: 0;
         }

         .radio-text {
             font-size: 14px;
             color: #374151;
         }

         .field-error {
             font-size: 12px;
             color: #ef4444;
             min-height: 16px;
         }

         .connection-area {
             display: flex;
             flex-direction: column;
             align-items: center;
             justify-content: center;
             min-height: 200px;
             position: relative;
         }

         .connection-line {
             width: 120px;
             height: 2px;
             background: #d1d5db;
             position: relative;
             cursor: pointer;
             transition: background-color 0.2s ease;
         }

         .connection-line:hover {
             background: #9ca3af;
         }

         .connection-line:hover .add-relay-btn {
             opacity: 1;
             transform: translate(-50%, -50%) scale(1);
         }

         .add-relay-btn {
             position: absolute;
             top: 50%;
             left: 50%;
             transform: translate(-50%, -50%) scale(0.8);
             width: 32px;
             height: 32px;
             background: #10b981;
             color: white;
             border: none;
             border-radius: 50%;
             font-size: 18px;
             font-weight: bold;
             cursor: pointer;
             opacity: 0;
             transition: all 0.2s ease;
             display: flex;
             align-items: center;
             justify-content: center;
         }

         .add-relay-btn:hover {
             background: #059669;
             transform: translate(-50%, -50%) scale(1.1);
         }

         .relay-devices-container {
             margin-top: 20px;
             display: flex;
             flex-direction: column;
             gap: 16px;
         }

         .relay-device {
             border: 1px solid #e5e7eb;
             border-radius: 6px;
             background: #f8fafc;
             padding: 16px;
             position: relative;
         }

         .relay-device-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 12px;
         }

         .relay-device-title {
             font-weight: 600;
             color: #374151;
             font-size: 14px;
         }

         .remove-relay-btn {
             background: #ef4444;
             color: white;
             border: none;
             border-radius: 4px;
             padding: 4px 8px;
             font-size: 12px;
             cursor: pointer;
             transition: background-color 0.2s ease;
         }

         .remove-relay-btn:hover {
             background: #dc2626;
         }

         .relay-device-content {
             display: flex;
             flex-direction: column;
             gap: 8px;
         }

         .relay-device-field {
             display: flex;
             flex-direction: column;
             gap: 4px;
         }

         .relay-device-label {
             font-size: 13px;
             color: #6b7280;
             font-weight: 500;
         }

         .relay-radio-group {
             display: flex;
             gap: 12px;
         }

         .relay-radio-option {
             display: flex;
             align-items: center;
             gap: 4px;
             cursor: pointer;
         }

         .relay-radio-option input[type="radio"] {
             margin: 0;
         }

         .relay-radio-text {
             font-size: 13px;
             color: #374151;
         }

         .link-edit-modal-footer {
             padding: 16px 24px 20px;
             border-top: 1px solid #e5e7eb;
             display: flex;
             justify-content: flex-end;
             gap: 12px;
         }

         @media (max-width: 1000px) {
             .link-edit-modal-content {
                 width: 95vw;
             }
             
             .link-edit-container {
                 grid-template-columns: 1fr;
                 gap: 20px;
             }
             
             .connection-area {
                 order: 1;
                 min-height: 60px;
             }
             
             .connection-line {
                 width: 100%;
                 height: 2px;
             }
         }

         /* ÂìçÂ∫îÂºèËÆæËÆ° */
         @media (max-width: 768px) {
             .main-content {
                 padding: 16px;
             }

             .form-container {
                 padding: 20px;
             }

             .form-grid {
                 grid-template-columns: 1fr;
             }

             .steps {
                 flex-direction: column;
                 gap: 16px;
             }

             .steps::before {
                 display: none;
             }

             .batch-grid {
                 grid-template-columns: 1fr;
             }

             .operation-blocks-header {
                 flex-direction: column;
                 gap: 12px;
                 align-items: stretch;
             }

             .block-basic-info {
                 grid-template-columns: 1fr;
             }

             .devices-table {
                 overflow-x: auto;
             }

             .devices-table th,
             .devices-table td {
                 padding: 6px 4px;
                 font-size: 12px;
             }
         }
    </style>
</head>
<body>
    <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
    <nav class="navbar">
        <div class="logo">DCIMËøêÁª¥Á≥ªÁªü</div>
        <ul class="nav-menu">
            <li class="nav-item">ËµÑÊ∫êÁÆ°ÁêÜ</li>
            <li class="nav-item active">Áâ©ÁêÜËµÑÊ∫êË∞ÉÂ∫¶‰∏≠ÂøÉ</li>
            <li class="nav-item">ËÆæÂ§áÁõëÊéß</li>
            <li class="nav-item">ËøêÁª¥Êä•Âëä</li>
            <li class="nav-item">Á≥ªÁªüËÆæÁΩÆ</li>
        </ul>
    </nav>

    <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
    <div class="main-content">
        <!-- È°µÈù¢Ê†áÈ¢ò -->
        <div class="page-header">
            <button class="back-btn" onclick="window.location.href='physical-resource-scheduling.html'" title="ËøîÂõûÂàóË°®">
                ‚Üê
            </button>
            <h1 class="page-title">Êñ∞Â¢ûË∞ÉÂ∫¶‰ªªÂä°</h1>
        </div>

        <!-- Ê≠•È™§Êù° -->
        <div class="steps-container">
            <div class="steps">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-title">Ë∞ÉÂ∫¶‰ªªÂä°ÁôªËÆ∞</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-title">ËÆæÂ§áË∞ÉÂ∫¶ÁÆ°ÁêÜ</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-title">ÈìæË∑ØÊãìÊâëË∞ÉÊï¥</div>
                </div>
            </div>
        </div>

        <!-- Ë°®ÂçïÂÜÖÂÆπ -->
        <div class="form-container">
            <!-- Á¨¨‰∏ÄÊ≠•ÔºöË∞ÉÂ∫¶‰ªªÂä°ÁôªËÆ∞ -->
            <div id="step1" class="step-content">
                <div class="form-section">
                    <h3 class="form-section-title">Âü∫Á°Ä‰ø°ÊÅØ</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                Âª∫ËÆæÂçïÂè∑ <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="constructionId" placeholder="ËØ∑ËæìÂÖ•Âª∫ËÆæÂçïÂè∑">
                            <div class="form-error" id="constructionIdError"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                ‰∏öÂä°Á±ªÂûã <span class="required">*</span>
                            </label>
                            <select class="form-select" id="operationType">
                                <option value="">ËØ∑ÈÄâÊã©‰∏öÂä°Á±ªÂûã</option>
                                <option value="UP">‰∏äÊû∂</option>
                                <option value="DOWN">‰∏ãÊû∂</option>
                                <option value="CUTOVER">Ââ≤Êé•</option>
                            </select>
                            <div class="form-error" id="operationTypeError"></div>
                        </div>

                        <div class="form-group full-width">
                            <label class="form-label">
                                ‰∏öÂä°Ê†áÈ¢ò <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="title" placeholder="ËØ∑ËæìÂÖ•‰∏öÂä°Ê†áÈ¢ò">
                            <div class="form-error" id="titleError"></div>
                        </div>

                        <div class="form-group full-width">
                            <label class="form-label">
                                ‰∏öÂä°ÊèèËø∞ <span class="required">*</span>
                            </label>
                            <textarea class="form-textarea" id="description" placeholder="ËØ∑ÁÆÄË¶ÅÊèèËø∞‰∏öÂä°ÂÜÖÂÆπÔºà10-50Â≠óÔºâ"></textarea>
                            <div class="form-help">Â≠óÊï∞ÈôêÂà∂Ôºö10-50Â≠ó</div>
                            <div class="form-error" id="descriptionError"></div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="form-section-title">ÊâßË°åÊó∂Èó¥</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                ÂºÄÂßãÊó∂Èó¥ <span class="required">*</span>
                            </label>
                            <input type="datetime-local" class="form-input" id="executionStart">
                            <div class="form-error" id="executionStartError"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                ÁªìÊùüÊó∂Èó¥ <span class="required">*</span>
                            </label>
                            <input type="datetime-local" class="form-input" id="executionEnd">
                            <div class="form-error" id="executionEndError"></div>
                        </div>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="muteAlerts">
                        <label for="muteAlerts">ÊòØÂê¶Âú®ÊâßË°åÊó∂Èó¥ÂÜÖÂ±èËîΩÊâÄÊúâÁõ∏ÂÖ≥ÂëäË≠¶‰ø°ÊÅØ</label>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="form-section-title">Ëß£ÊûêÊñáÊ°£ÁöÑÂØºÂÖ•</h3>
                    <div class="form-tips">
                        ÊñáÊ°£Ëß£ÊûêÂêé‰ºöËá™Âä®Â°´ÂÜôËÆæÂ§á„ÄÅÈìæË∑ØÊï∞ÊçÆÔºå<a href="#" onclick="downloadImportTemplate()" style="color: #667eea; text-decoration: none;">ÁÇπÂáª‰∏ãËΩΩÂØºÂÖ•Ê®°Áâà</a>
                    </div>
                    <div class="file-upload" id="fileUpload">
                        <div class="file-upload-icon">üìé</div>
                        <div class="file-upload-text">
                            ÁÇπÂáªÊàñÊãñÊãΩ‰∏ä‰º†ExcelÊñáÊ°£<br>
                            <small>ÊîØÊåÅÊ†ºÂºèÔºöxlsx„ÄÅxls</small>
                        </div>
                        <input type="file" id="attachment" accept=".xlsx,.xls" style="display: none;">
                    </div>
                    <div id="uploadedFiles"></div>
                </div>


            </div>

            <!-- Á¨¨‰∫åÊ≠•ÔºöËÆæÂ§áË∞ÉÂ∫¶ÁÆ°ÁêÜ -->
            <div id="step2" class="step-content" style="display: none;">
                <div class="form-section">
                    <h3 class="form-section-title">ËÆæÂ§áË∞ÉÂ∫¶ÁÆ°ÁêÜ</h3>
                    
                    <!-- Êìç‰ΩúÁ±ªÂûãÂùóÁÆ°ÁêÜ -->
                    <div class="operation-blocks-container">
                        <div class="operation-blocks-header">
                            <div class="blocks-info">
                                <span>Êìç‰ΩúÁ±ªÂûãÂùóÔºö<span id="totalBlocks">0</span> ‰∏™</span>
                                <span>ÊÄªËÆæÂ§áÊï∞Ôºö<span id="totalDevices">0</span> Âè∞</span>
                            </div>
                            <button class="btn btn-primary" onclick="addOperationBlock()">
                                <span>+</span>
                                Ê∑ªÂä†Êìç‰ΩúÁ±ªÂûãÂùó
                            </button>
                        </div>
                        
                        <div id="operationBlocksContainer">
                            <!-- Êìç‰ΩúÁ±ªÂûãÂùóÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÊ∑ªÂä† -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Á¨¨‰∏âÊ≠•ÔºöÈìæË∑ØÊãìÊâëË∞ÉÊï¥ -->
            <div id="step3" class="step-content" style="display: none;">
                <div class="form-section">
                    <h3 class="form-section-title">ÈìæË∑ØÊãìÊâëË∞ÉÊï¥</h3>
                    
                    <!-- Êìç‰ΩúÁ±ªÂûãÂùóÁÆ°ÁêÜ -->
                    <div class="topology-blocks-container">
                        <div class="topology-blocks-header">
                            <div class="blocks-info">
                                <span>Êìç‰ΩúÁ±ªÂûãÂùóÔºö<span id="totalTopologyBlocks">0</span> ‰∏™</span>
                                <span>ÊÄªÈìæË∑ØÊï∞Ôºö<span id="totalLinks">0</span> Êù°</span>
                            </div>
                            <button class="btn btn-primary" onclick="addTopologyBlock()">
                                <span>+</span>
                                Ê∑ªÂä†Êìç‰ΩúÁ±ªÂûãÂùó
                            </button>
                        </div>
                        
                        <div id="topologyBlocksContainer">
                            <!-- Êìç‰ΩúÁ±ªÂûãÂùóÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÊ∑ªÂä† -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Â∫ïÈÉ®Êìç‰ΩúÊ†è -->
        <div class="form-actions">
            <button class="btn btn-outline" id="prevBtn" onclick="previousStep()" disabled>
                ‚Üê ‰∏ä‰∏ÄÊ≠•
            </button>
            <div>
                <button class="btn btn-outline" onclick="saveDraft()">‰øùÂ≠òËçâÁ®ø</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                    ‰∏ã‰∏ÄÊ≠• ‚Üí
                </button>
            </div>
        </div>
    </div>



     <!-- ÊñáÊ°£Ëß£ÊûêÊ®°ÊÄÅÊ°Ü -->
     <div class="modal" id="parseModal">
         <div class="modal-content">
             <div class="modal-header">
                 <h3 class="modal-title">ÊñáÊ°£Ëß£Êûê</h3>
             </div>
             <div class="modal-body">
                 <!-- Ëß£Êûê‰∏≠Áä∂ÊÄÅ -->
                 <div id="parseLoading" class="parse-status">
                     <div class="loading-icon">‚è≥</div>
                     <div class="loading-text">ÊñáÊ°£Ê≠£Âú®Ëß£Êûê‰∏≠ÔºåËØ∑Á®çÂÄô...</div>
                 </div>
                 
                 <!-- Ëß£ÊûêÊàêÂäüÁä∂ÊÄÅ -->
                 <div id="parseSuccess" class="parse-status" style="display: none;">
                     <div class="success-icon">‚úÖ</div>
                     <div class="success-text">ÊñáÊ°£Ëß£ÊûêÊàêÂäüÔºÅ</div>
                     <div class="parse-result">
                         <p>Â∑≤ÊàêÂäüËß£Êûê <span id="parsedDevices">0</span> Âè∞ËÆæÂ§áÂíå <span id="parsedLinks">0</span> Êù°ÈìæË∑ØÊï∞ÊçÆ</p>
                     </div>
                 </div>
                 
                 <!-- Ëß£ÊûêÂ§±Ë¥•Áä∂ÊÄÅ -->
                 <div id="parseError" class="parse-status" style="display: none;">
                     <div class="error-icon">‚ùå</div>
                     <div class="error-text">ÊñáÊ°£Ëß£ÊûêÂ§±Ë¥•</div>
                     <div class="error-reason" id="parseErrorReason">
                         <!-- Â§±Ë¥•ÂéüÂõ†Â∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                     </div>
                     <div class="error-actions">
                         <a href="#" onclick="downloadErrorData()" style="color: #667eea; text-decoration: none;">‰∏ãËΩΩÈîôËØØÊï∞ÊçÆ</a>
                         ÈáçÊñ∞ÂØºÂÖ•
                     </div>
                 </div>
             </div>
             <div class="modal-footer">
                 <div id="parseLoadingButtons" style="display: none;">
                     <!-- Ëß£Êûê‰∏≠‰∏çÊòæÁ§∫ÊåâÈíÆ -->
                 </div>
                 <div id="parseSuccessButtons" style="display: none;">
                     <button class="btn btn-primary" onclick="confirmParsedData()">Á°ÆËÆ§</button>
                 </div>
                 <div id="parseErrorButtons" style="display: none;">
                     <button class="btn btn-outline" onclick="closeParseModal()">ÂèñÊ∂à</button>
                     <button class="btn btn-primary" onclick="retryParse()">ÈáçÊñ∞ÂØºÂÖ•</button>
                 </div>
             </div>
         </div>
     </div>

     <!-- Êâ©Â±ïÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü -->
     <div class="modal" id="extraConfigModal">
         <div class="modal-content">
             <div class="modal-header">
                 <h3 class="modal-title">Êâ©Â±ïÈÖçÁΩÆ</h3>
                 <button class="modal-close" onclick="closeExtraConfigModal()">&times;</button>
             </div>
             <div class="modal-body">
                 <div class="form-group">
                     <label class="form-label">SID/CID</label>
                     <input type="text" class="form-input" id="sidCid" placeholder="Ê†ºÂºèÁ§∫‰æã: SID-1001 Êàñ CID-2001">
                 </div>
                 
                 <div class="form-group">
                     <label class="form-label">ËøûÊé•Ê†áÁ≠æÁºñÁ†Å</label>
                     <input type="text" class="form-input" id="connectionCode" placeholder="Â¶Ç: CN-BJ-PRI-001">
                 </div>
                 
                 <div class="form-group">
                     <label class="form-label">ÂõΩÂÆ∂</label>
                     <select class="form-select" id="country" onchange="updateCityOptions()">
                         <option value="CN">‰∏≠ÂõΩ</option>
                         <option value="US">ÁæéÂõΩ</option>
                         <option value="JP">Êó•Êú¨</option>
                         <option value="KR">Èü©ÂõΩ</option>
                         <option value="SG">Êñ∞Âä†Âù°</option>
                     </select>
                 </div>
                 
                 <div class="form-group">
                     <label class="form-label">ÂüéÂ∏Ç</label>
                     <select class="form-select" id="city">
                         <!-- ÂüéÂ∏ÇÈÄâÈ°πÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÂä†ËΩΩ -->
                     </select>
                 </div>
             </div>
             <div class="modal-footer">
                 <button class="btn btn-outline" onclick="closeExtraConfigModal()">ÂèñÊ∂à</button>
                 <button class="btn btn-primary" onclick="saveExtraConfig()">‰øùÂ≠ò</button>
             </div>
         </div>
     </div>

     <!-- ÈìæË∑ØÁºñËæëÊ®°ÊÄÅÊ°Ü -->
     <div class="link-edit-modal" id="linkEditModal">
         <div class="link-edit-modal-content">
             <div class="link-edit-modal-header">
                 <h3 class="link-edit-modal-title">ËøûÊé•‰ø°ÊÅØÁºñËæë</h3>
                 <button class="link-edit-modal-close" onclick="closeLinkEditModal()">&times;</button>
             </div>
             <div class="link-edit-modal-body">
                 <div class="link-edit-container">
                     <!-- AÁ´Ø -->
                     <div class="link-endpoint">
                         <div class="endpoint-header">AÁ´Ø</div>
                         <div class="endpoint-content">
                             <div class="endpoint-field">
                                 <label class="endpoint-label">ËµÑ‰∫ßÁºñÁ†Å</label>
                                 <input type="text" class="endpoint-input" id="editADeviceCode" placeholder="ËØ∑ËæìÂÖ•">
                                 <div class="field-error" id="editADeviceCodeError"></div>
                             </div>
                             
                             <div class="endpoint-field">
                                 <label class="endpoint-label">Á´ØÂè£Âè∑</label>
                                 <input type="text" class="endpoint-input" id="editAPortNumber" placeholder="ËØ∑ËæìÂÖ•">
                                 <div class="field-error" id="editAPortNumberError"></div>
                             </div>
                             
                             <div class="endpoint-field">
                                 <label class="endpoint-label">Á´ØÂè£Ê®°Âùó</label>
                                 <input type="text" class="endpoint-input" id="editAPortModule" placeholder="ËØ∑ËæìÂÖ•">
                                 <div class="field-error" id="editAPortModuleError"></div>
                             </div>
                             
                             <div class="endpoint-field">
                                 <label class="endpoint-label">ÊòØÂê¶‰∏äËÅîPPÊû∂</label>
                                 <div class="radio-group">
                                     <label class="radio-option">
                                         <input type="radio" name="editAIsPpFrame" value="false" checked>
                                         <span class="radio-text">Âê¶</span>
                                     </label>
                                     <label class="radio-option">
                                         <input type="radio" name="editAIsPpFrame" value="true">
                                         <span class="radio-text">ÊòØ</span>
                                     </label>
                                 </div>
                             </div>
                         </div>
                     </div>
                     
                     <!-- ËøûÊé•Á∫øÂå∫Âüü -->
                     <div class="connection-area">
                         <div class="connection-line" id="connectionLine">
                             <div class="add-relay-btn" id="addRelayBtn" onclick="addRelayDevice()">+</div>
                         </div>
                         
                         <!-- ‰∏≠ÁªßËÆæÂ§áÂÆπÂô® -->
                         <div class="relay-devices-container" id="relayDevicesContainer">
                             <!-- ‰∏≠ÁªßËÆæÂ§áÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÊ∑ªÂä† -->
                         </div>
                     </div>
                     
                     <!-- ZÁ´Ø -->
                     <div class="link-endpoint">
                         <div class="endpoint-header">ZÁ´Ø</div>
                         <div class="endpoint-content">
                             <div class="endpoint-field">
                                 <label class="endpoint-label">ËµÑ‰∫ßÁºñÁ†Å</label>
                                 <input type="text" class="endpoint-input" id="editZDeviceCode" placeholder="ËØ∑ËæìÂÖ•">
                                 <div class="field-error" id="editZDeviceCodeError"></div>
                             </div>
                             
                             <div class="endpoint-field">
                                 <label class="endpoint-label">Á´ØÂè£Âè∑</label>
                                 <input type="text" class="endpoint-input" id="editZPortNumber" placeholder="ËØ∑ËæìÂÖ•">
                                 <div class="field-error" id="editZPortNumberError"></div>
                             </div>
                             
                             <div class="endpoint-field">
                                 <label class="endpoint-label">Á´ØÂè£Ê®°Âùó</label>
                                 <input type="text" class="endpoint-input" id="editZPortModule" placeholder="ËØ∑ËæìÂÖ•">
                                 <div class="field-error" id="editZPortModuleError"></div>
                             </div>
                             
                             <div class="endpoint-field">
                                 <label class="endpoint-label">ÊòØÂê¶‰∏äËÅîPPÊû∂</label>
                                 <div class="radio-group">
                                     <label class="radio-option">
                                         <input type="radio" name="editZIsPpFrame" value="false" checked>
                                         <span class="radio-text">Âê¶</span>
                                     </label>
                                     <label class="radio-option">
                                         <input type="radio" name="editZIsPpFrame" value="true">
                                         <span class="radio-text">ÊòØ</span>
                                     </label>
                                 </div>
                             </div>
                         </div>
                     </div>
                 </div>
             </div>
             <div class="link-edit-modal-footer">
                 <button class="btn btn-outline" onclick="closeLinkEditModal()">ÂèñÊ∂à</button>
                 <button class="btn btn-primary" onclick="saveLinkEdit()">Á°ÆÂÆö</button>
             </div>
         </div>
     </div>

     <script>
                 // ÂÖ®Â±ÄÁä∂ÊÄÅ
         let currentStep = 1;
         
         let operationBlocks = [];
         let blockCounter = 1;
         let topologyBlocks = [];
         let topologyBlockCounter = 1;
         let currentExtraConfigLink = null;
         let currentEditingLink = null;
         let relayDeviceCounter = 1;
         
         // Ê®°ÊãüÊï∞ÊçÆ
         const mockAssetData = {
             'AS001': { sn: 'SN123456789', model: 'Dell PowerEdge R740' },
             'AS002': { sn: 'SN987654321', model: 'HP ProLiant DL380' },
             'AS003': { sn: 'SN456789123', model: 'Cisco Catalyst 9300' },
             'AS004': { sn: 'SN789123456', model: 'Huawei CE6800' },
             'AS005': { sn: 'SN321654987', model: 'Dell PowerEdge R640' },
             'AS006': { sn: 'SN111222333', model: 'IBM X3650 M5' },
             'AS007': { sn: 'SN444555666', model: 'Lenovo ThinkSystem SR650' },
             'AS008': { sn: 'SN777888999', model: 'Cisco Nexus 9000' },
             'AS009': { sn: 'SN000111222', model: 'Huawei S12700' },
             'AS010': { sn: 'SN333444555', model: 'Dell EMC PowerEdge R750' }
         };
         
         const roomOptions = ['AÊú∫Êàø', 'BÊú∫Êàø', 'CÊú∫Êàø', 'DÊú∫Êàø'];
         const cabinetOptions = ['CAB-A01', 'CAB-A02', 'CAB-B01', 'CAB-B02', 'CAB-C01', 'CAB-C02'];
         const companyOptions = ['ÈòøÈáåÂ∑¥Â∑¥', 'ËÖæËÆØ', 'ÁôæÂ∫¶', '‰∫¨‰∏ú', 'Â≠óËäÇË∑≥Âä®'];
         
         // ÂüéÂ∏ÇÊï∞ÊçÆ
         const cityOptions = {
             'CN': ['Âåó‰∫¨', '‰∏äÊµ∑', 'ÂπøÂ∑û', 'Ê∑±Âú≥', 'Êù≠Â∑û', 'Âçó‰∫¨', 'ÊàêÈÉΩ', 'Ê≠¶Ê±â'],
             'US': ['Á∫ΩÁ∫¶', 'Ê¥õÊùâÁü∂', 'ËäùÂä†Âì•', 'ÊóßÈáëÂ±±', 'Ë•øÈõÖÂõæ', 'Ê≥¢Â£´È°ø'],
             'JP': ['‰∏ú‰∫¨', 'Â§ßÈò™', '‰∫¨ÈÉΩ', 'Ê®™Êª®', 'ÂêçÂè§Â±ã', 'Á•ûÊà∑'],
             'KR': ['È¶ñÂ∞î', 'ÈáúÂ±±', '‰ªÅÂ∑ù', 'Â§ßÈÇ±', 'Â§ßÁî∞'],
             'SG': ['Êñ∞Âä†Âù°']
         };

        // È°µÈù¢ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ËÆæÁΩÆÊúÄÂ∞èÊó•ÊúüÊó∂Èó¥‰∏∫ÂΩìÂâçÊó∂Èó¥
            const now = new Date();
            const minDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('executionStart').min = minDateTime;
            document.getElementById('executionEnd').min = minDateTime;

            // Êñá‰ª∂‰∏ä‰º†‰∫ã‰ª∂
            setupFileUpload();
            
            // Ë°®ÂçïÈ™åËØÅ‰∫ã‰ª∂
            setupFormValidation();
            
            // ÂàùÂßãÂåñÂüéÂ∏ÇÈÄâÈ°π
            updateCityOptions();
        });

        // Ê≠•È™§ÂØºËà™
        function nextStep() {
            if (validateCurrentStep()) {
                if (currentStep < 3) {
                    currentStep++;
                    updateStepDisplay();
                } else {
                    // ÊúÄÂêé‰∏ÄÊ≠•ÔºåÊèê‰∫§Ë°®Âçï
                    submitForm();
                }
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
            }
        }

        function updateStepDisplay() {
            // Êõ¥Êñ∞Ê≠•È™§Êù°Áä∂ÊÄÅ
            document.querySelectorAll('.step').forEach((step, index) => {
                const stepNumber = index + 1;
                step.classList.remove('active', 'completed');
                
                if (stepNumber < currentStep) {
                    step.classList.add('completed');
                } else if (stepNumber === currentStep) {
                    step.classList.add('active');
                }
            });

            // ÊòæÁ§∫ÂØπÂ∫îÊ≠•È™§ÂÜÖÂÆπ
            document.querySelectorAll('.step-content').forEach((content, index) => {
                content.style.display = index + 1 === currentStep ? 'block' : 'none';
            });

            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            document.getElementById('prevBtn').disabled = currentStep === 1;
            const nextBtn = document.getElementById('nextBtn');
            if (currentStep === 3) {
                nextBtn.textContent = 'Á°ÆËÆ§Êèê‰∫§';
                nextBtn.innerHTML = 'Á°ÆËÆ§Êèê‰∫§ ‚úì';
            } else {
                nextBtn.innerHTML = '‰∏ã‰∏ÄÊ≠• ‚Üí';
            }
        }

        // Ë°®ÂçïÈ™åËØÅ
        function validateCurrentStep() {
            if (currentStep === 1) {
                return validateStep1();
            } else if (currentStep === 2) {
                return validateStep2();
            } else if (currentStep === 3) {
                return validateStep3();
            }
            return true;
        }

        function validateStep1() {
            let isValid = true;
            
            // Ê∏ÖÈô§‰πãÂâçÁöÑÈîôËØØ
            document.querySelectorAll('.form-error').forEach(error => error.textContent = '');

            // È™åËØÅÂª∫ËÆæÂçïÂè∑
            const constructionId = document.getElementById('constructionId').value.trim();
            if (!constructionId) {
                document.getElementById('constructionIdError').textContent = 'ËØ∑ËæìÂÖ•Âª∫ËÆæÂçïÂè∑';
                isValid = false;
            }

            // È™åËØÅ‰∏öÂä°Á±ªÂûã
            const operationType = document.getElementById('operationType').value;
            if (!operationType) {
                document.getElementById('operationTypeError').textContent = 'ËØ∑ÈÄâÊã©‰∏öÂä°Á±ªÂûã';
                isValid = false;
            }

            // È™åËØÅ‰∏öÂä°Ê†áÈ¢ò
            const title = document.getElementById('title').value.trim();
            if (!title) {
                document.getElementById('titleError').textContent = 'ËØ∑ËæìÂÖ•‰∏öÂä°Ê†áÈ¢ò';
                isValid = false;
            }

            // È™åËØÅ‰∏öÂä°ÊèèËø∞
            const description = document.getElementById('description').value.trim();
            if (!description) {
                document.getElementById('descriptionError').textContent = 'ËØ∑ËæìÂÖ•‰∏öÂä°ÊèèËø∞';
                isValid = false;
            } else if (description.length < 10) {
                document.getElementById('descriptionError').textContent = '‰∏öÂä°ÊèèËø∞Ëá≥Â∞ëÈúÄË¶Å10‰∏™Â≠óÁ¨¶';
                isValid = false;
            } else if (description.length > 50) {
                document.getElementById('descriptionError').textContent = '‰∏öÂä°ÊèèËø∞‰∏çËÉΩË∂ÖËøá50‰∏™Â≠óÁ¨¶';
                isValid = false;
            }

            // È™åËØÅÊâßË°åÊó∂Èó¥
            const executionStart = document.getElementById('executionStart').value;
            const executionEnd = document.getElementById('executionEnd').value;
            
            if (!executionStart) {
                document.getElementById('executionStartError').textContent = 'ËØ∑ÈÄâÊã©ÂºÄÂßãÊó∂Èó¥';
                isValid = false;
            } else {
                const startTime = new Date(executionStart);
                const now = new Date();
                if (startTime <= now) {
                    document.getElementById('executionStartError').textContent = 'ÂºÄÂßãÊó∂Èó¥ÂøÖÈ°ªÊòØÂ∞ÜÊù•ÁöÑÊó∂Èó¥';
                    isValid = false;
                }
            }

            if (!executionEnd) {
                document.getElementById('executionEndError').textContent = 'ËØ∑ÈÄâÊã©ÁªìÊùüÊó∂Èó¥';
                isValid = false;
            } else if (executionStart && executionEnd) {
                const startTime = new Date(executionStart);
                const endTime = new Date(executionEnd);
                if (endTime <= startTime) {
                    document.getElementById('executionEndError').textContent = 'ÁªìÊùüÊó∂Èó¥ÂøÖÈ°ªÊôö‰∫éÂºÄÂßãÊó∂Èó¥';
                    isValid = false;
                }
            }

            return isValid;
        }

                 function validateStep2() {
             // È™åËØÅÊìç‰ΩúÁ±ªÂûãÂùó
             if (operationBlocks.length === 0) {
                 alert('ËØ∑Ëá≥Â∞ëÊ∑ªÂä†‰∏Ä‰∏™Êìç‰ΩúÁ±ªÂûãÂùó');
                 return false;
             }
             
             let isValid = true;
             for (let block of operationBlocks) {
                 // È™åËØÅÂü∫Á°Ä‰ø°ÊÅØ
                 if (!block.operationType) {
                     alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} Êú™ÈÄâÊã©Êìç‰ΩúÁ±ªÂûã`);
                     isValid = false;
                     break;
                 }
                 
                 if (!block.deviceType) {
                     alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} Êú™ÈÄâÊã©ËÆæÂ§áÁ±ªÂûã`);
                     isValid = false;
                     break;
                 }
                 
                 if (!block.room) {
                     alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} Êú™ÈÄâÊã©Êú∫Êàø`);
                     isValid = false;
                     break;
                 }
                 
                 // È™åËØÅËÆæÂ§á‰ø°ÊÅØ
                 if (block.devices.length === 0) {
                     alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} Ëá≥Â∞ëÈúÄË¶ÅÊ∑ªÂä†‰∏ÄÂè∞ËÆæÂ§á`);
                     isValid = false;
                     break;
                 }
                 
                 // È™åËØÅÊØèÂè∞ËÆæÂ§áÁöÑÂøÖÂ°´Â≠óÊÆµ
                 for (let device of block.devices) {
                     if (!device.assetId) {
                         alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} ‰∏≠ÊúâËÆæÂ§áÊú™Â°´ÂÜôËµÑ‰∫ßÁºñÂè∑`);
                         isValid = false;
                         break;
                     }
                     if (!device.cabinet) {
                         alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} ‰∏≠ÊúâËÆæÂ§áÊú™ÈÄâÊã©Êú∫Êüú`);
                         isValid = false;
                         break;
                     }
                     if (!device.startU) {
                         alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} ‰∏≠ÊúâËÆæÂ§áÊú™ÈÄâÊã©Ëµ∑ÂßãU‰Ωç`);
                         isValid = false;
                         break;
                     }
                     if (!device.ownerCompany) {
                         alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} ‰∏≠ÊúâËÆæÂ§áÊú™ÈÄâÊã©‰ΩøÁî®ÂÖ¨Âè∏`);
                         isValid = false;
                         break;
                     }
                     
                     // È™åËØÅIPÊ†ºÂºè
                     if (device.privateIp && !isValidIP(device.privateIp)) {
                         alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} ‰∏≠ÊúâËÆæÂ§áÁöÑÂÜÖÁΩëIPÊ†ºÂºè‰∏çÊ≠£Á°Æ`);
                         isValid = false;
                         break;
                     }
                     if (device.publicIp && !isValidIP(device.publicIp)) {
                         alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} ‰∏≠ÊúâËÆæÂ§áÁöÑÂÖ¨ÁΩëIPÊ†ºÂºè‰∏çÊ≠£Á°Æ`);
                         isValid = false;
                         break;
                     }
                 }
                 
                 if (!isValid) break;
             }
             
             return isValid;
         }

                 function validateStep3() {
             // È™åËØÅÈìæË∑ØÊãìÊâëË∞ÉÊï¥
             if (topologyBlocks.length === 0) {
                 alert('ËØ∑Ëá≥Â∞ëÊ∑ªÂä†‰∏Ä‰∏™Êìç‰ΩúÁ±ªÂûãÂùó');
                 return false;
             }
             
             let isValid = true;
             for (let block of topologyBlocks) {
                 // È™åËØÅÂü∫Á°Ä‰ø°ÊÅØ
                 if (!block.operationType) {
                     alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} Êú™ÈÄâÊã©Êìç‰ΩúÁ±ªÂûã`);
                     isValid = false;
                     break;
                 }
                 
                 if (!block.deviceType) {
                     alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} Êú™ÈÄâÊã©ËÆæÂ§áÁ±ªÂûã`);
                     isValid = false;
                     break;
                 }
                 
                 if (!block.room) {
                     alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} Êú™ÈÄâÊã©Êú∫Êàø`);
                     isValid = false;
                     break;
                 }
                 
                 // È™åËØÅÈìæË∑Ø‰ø°ÊÅØ
                 if (block.links.length === 0) {
                     alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} Ëá≥Â∞ëÈúÄË¶ÅÊ∑ªÂä†‰∏ÄÊù°ÈìæË∑Ø`);
                     isValid = false;
                     break;
                 }
                 
                 // È™åËØÅÊØèÊù°ÈìæË∑ØÁöÑÂøÖÂ°´Â≠óÊÆµ
                 for (let link of block.links) {
                     if (!link.channelName) {
                         alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} ‰∏≠ÊúâÈìæË∑ØÊú™Â°´ÂÜôÈÄöÈÅìÂêçÁß∞`);
                         isValid = false;
                         break;
                     }
                     if (!link.aEnd.deviceCode) {
                         alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} ‰∏≠ÊúâÈìæË∑ØAÁ´ØÊú™Â°´ÂÜôËÆæÂ§áÁºñÁ†Å`);
                         isValid = false;
                         break;
                     }
                     if (!link.zEnd.deviceCode) {
                         alert(`Êìç‰ΩúÁ±ªÂûãÂùó ${block.id} ‰∏≠ÊúâÈìæË∑ØZÁ´ØÊú™Â°´ÂÜôËÆæÂ§áÁºñÁ†Å`);
                         isValid = false;
                         break;
                     }
                 }
                 
                 if (!isValid) break;
             }
             
             return isValid;
         }

        // Ë°®ÂçïÈ™åËØÅ‰∫ã‰ª∂ËÆæÁΩÆ
        function setupFormValidation() {
            // ÊèèËø∞Â≠óÊï∞ÂÆûÊó∂ÁªüËÆ°
            const description = document.getElementById('description');
            description.addEventListener('input', function() {
                const length = this.value.length;
                const helpText = this.nextElementSibling;
                helpText.textContent = `Â≠óÊï∞ÈôêÂà∂Ôºö10-50Â≠ó (ÂΩìÂâçÔºö${length}Â≠ó)`;
                
                if (length > 50) {
                    helpText.style.color = '#ef4444';
                } else if (length < 10) {
                    helpText.style.color = '#f59e0b';
                } else {
                    helpText.style.color = '#10b981';
                }
            });

            // ÁªìÊùüÊó∂Èó¥Ëá™Âä®Â°´ÂÖÖ
            document.getElementById('executionStart').addEventListener('change', function() {
                const startTime = new Date(this.value);
                if (startTime) {
                    // ÈªòËÆ§ÁªìÊùüÊó∂Èó¥‰∏∫ÂºÄÂßãÊó∂Èó¥ + 2Â∞èÊó∂
                    const endTime = new Date(startTime.getTime() + 2 * 60 * 60 * 1000);
                    const endTimeString = endTime.toISOString().slice(0, 16);
                    document.getElementById('executionEnd').value = endTimeString;
                }
            });
        }

        // Êñá‰ª∂‰∏ä‰º†
        function setupFileUpload() {
            const fileUpload = document.getElementById('fileUpload');
            const fileInput = document.getElementById('attachment');
            
            fileUpload.addEventListener('click', () => fileInput.click());
            
            fileUpload.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUpload.classList.add('dragover');
            });
            
            fileUpload.addEventListener('dragleave', (e) => {
                e.preventDefault();
                fileUpload.classList.remove('dragover');
            });
            
            fileUpload.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUpload.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload(files[0]);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });
        }

        function handleFileUpload(file) {
            // È™åËØÅÊñá‰ª∂Á±ªÂûã
            const allowedTypes = ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.ms-excel'];
            if (!allowedTypes.includes(file.type)) {
                alert('Âè™ËÉΩ‰∏ä‰º†ExcelÊñá‰ª∂Ôºà.xlsx, .xlsÔºâ');
                return;
            }

            // È™åËØÅÊñá‰ª∂Â§ßÂ∞èÔºàÊúÄÂ§ß10MBÔºâ
            if (file.size > 10 * 1024 * 1024) {
                alert('Êñá‰ª∂Â§ßÂ∞è‰∏çËÉΩË∂ÖËøá10MB');
                return;
            }

            displayUploadedFile(file);
            // ÂºÄÂßãËß£ÊûêÊñáÊ°£
            parseDocument(file);
        }

        function displayUploadedFile(file) {
            const uploadedFiles = document.getElementById('uploadedFiles');
            uploadedFiles.innerHTML = `
                <div class="uploaded-file">
                    <span>üìÑ ${file.name}</span>
                    <button class="remove-file" onclick="removeFile()">&times;</button>
                </div>
            `;
        }

        function removeFile() {
            document.getElementById('uploadedFiles').innerHTML = '';
            document.getElementById('attachment').value = '';
        }

        // ‰∏ãËΩΩÂØºÂÖ•Ê®°Áâà
        function downloadImportTemplate() {
            // Ê®°Êãü‰∏ãËΩΩExcelÊ®°Áâà
            const link = document.createElement('a');
            link.href = '#';
            link.download = 'ÂØºÂÖ•Ê®°Áâà.xlsx';
            alert('ÂØºÂÖ•Ê®°Áâà‰∏ãËΩΩÂäüËÉΩÔºàÊºîÁ§∫Ôºâ');
        }

        // ÂºÄÂßãËß£ÊûêÊñáÊ°£
        function parseDocument(file) {
            // ÊòæÁ§∫Ëß£ÊûêÊ®°ÊÄÅÊ°Ü
            document.getElementById('parseModal').classList.add('show');
            
            // ÈáçÁΩÆÁä∂ÊÄÅ
            document.getElementById('parseLoading').style.display = 'block';
            document.getElementById('parseSuccess').style.display = 'none';
            document.getElementById('parseError').style.display = 'none';
            document.getElementById('parseLoadingButtons').style.display = 'none';
            document.getElementById('parseSuccessButtons').style.display = 'none';
            document.getElementById('parseErrorButtons').style.display = 'none';
            
            // Ê®°ÊãüËß£ÊûêËøáÁ®ãÔºà2ÁßíÂª∂ËøüÔºâ
            setTimeout(() => {
                const isSuccess = Math.random() > 0.3; // 70%ÊàêÂäüÁéá
                
                if (isSuccess) {
                    // Ëß£ÊûêÊàêÂäü
                    const parsedDevices = Math.floor(Math.random() * 50) + 10; // 10-60Âè∞ËÆæÂ§á
                    const parsedLinks = Math.floor(Math.random() * 20) + 5; // 5-25Êù°ÈìæË∑Ø
                    
                    document.getElementById('parseLoading').style.display = 'none';
                    document.getElementById('parseSuccess').style.display = 'block';
                    document.getElementById('parseSuccessButtons').style.display = 'block';
                    
                    document.getElementById('parsedDevices').textContent = parsedDevices;
                    document.getElementById('parsedLinks').textContent = parsedLinks;
                } else {
                    // Ëß£ÊûêÂ§±Ë¥•
                    const errorReasons = [
                        'ÊñáÊ°£Ê†ºÂºèÈîôËØØÔºåËØ∑Ê£ÄÊü•Ë°®Â§¥ÊòØÂê¶Ê≠£Á°Æ',
                        'Á¨¨3Ë°åËÆæÂ§áÁºñÁ†ÅÊ†ºÂºè‰∏çÁ¨¶ÂêàËßÑËåÉ',
                        'ÂèëÁé∞ÈáçÂ§çÁöÑËÆæÂ§áÁºñÁ†ÅÔºöSRV-001',
                        'Áº∫Â∞ëÂøÖÂ°´Â≠óÊÆµÔºöËÆæÂ§áÁ±ªÂûã',
                        'ÈìæË∑ØÈÖçÁΩÆ‰ø°ÊÅØ‰∏çÂÆåÊï¥ÔºåÁº∫Â∞ëÁ´ØÂè£‰ø°ÊÅØ'
                    ];
                    const randomError = errorReasons[Math.floor(Math.random() * errorReasons.length)];
                    
                    document.getElementById('parseLoading').style.display = 'none';
                    document.getElementById('parseError').style.display = 'block';
                    document.getElementById('parseErrorButtons').style.display = 'block';
                    
                    document.getElementById('parseErrorReason').textContent = randomError;
                }
            }, 2000);
        }

        // Á°ÆËÆ§Ëß£ÊûêÁöÑÊï∞ÊçÆ
        function confirmParsedData() {
            document.getElementById('parseModal').classList.remove('show');
            alert('ÊñáÊ°£Ëß£ÊûêÊàêÂäüÔºÅËÆæÂ§áÂíåÈìæË∑ØÊï∞ÊçÆÂ∑≤Ëá™Âä®Â°´ÂÜôÂà∞Áõ∏Â∫îÊ≠•È™§‰∏≠„ÄÇ');
        }

        // ÂÖ≥Èó≠Ëß£ÊûêÊ®°ÊÄÅÊ°Ü
        function closeParseModal() {
            document.getElementById('parseModal').classList.remove('show');
        }

        // ÈáçÊñ∞Ëß£Êûê
        function retryParse() {
            const fileInput = document.getElementById('attachment');
            if (fileInput.files.length > 0) {
                parseDocument(fileInput.files[0]);
            } else {
                alert('ËØ∑ÈáçÊñ∞ÈÄâÊã©Êñá‰ª∂');
                closeParseModal();
            }
        }

        // ‰∏ãËΩΩÈîôËØØÊï∞ÊçÆ
        function downloadErrorData() {
            const link = document.createElement('a');
            link.href = '#';
            link.download = 'ÈîôËØØÊï∞ÊçÆÊä•Âëä.xlsx';
            alert('ÈîôËØØÊï∞ÊçÆ‰∏ãËΩΩÂäüËÉΩÔºàÊºîÁ§∫Ôºâ');
        }



        // ‰øùÂ≠òËçâÁ®ø
        function saveDraft() {
            const formData = collectFormData();
            localStorage.setItem('taskDraft', JSON.stringify(formData));
            alert('ËçâÁ®øÂ∑≤‰øùÂ≠òÔºÅ');
        }

                 // Êî∂ÈõÜË°®ÂçïÊï∞ÊçÆ
         function collectFormData() {
             return {
                 step1: {
                     constructionId: document.getElementById('constructionId').value,
                     operationType: document.getElementById('operationType').value,
                     title: document.getElementById('title').value,
                     description: document.getElementById('description').value,
                     executionStart: document.getElementById('executionStart').value,
                     executionEnd: document.getElementById('executionEnd').value,
                     muteAlerts: document.getElementById('muteAlerts').checked,
                     attachment: document.getElementById('attachment').files[0]?.name || ''
                 },
                 step2: {
                     operationBlocks: operationBlocks,
                     totalBlocks: operationBlocks.length,
                     totalDevices: operationBlocks.reduce((sum, block) => sum + block.devices.length, 0)
                 },
                 step3: {
                     topologyBlocks: topologyBlocks,
                     totalTopologyBlocks: topologyBlocks.length,
                     totalLinks: topologyBlocks.reduce((sum, block) => sum + block.links.length, 0)
                 }
             };
         }

        // Êèê‰∫§Ë°®Âçï
        function submitForm() {
            const formData = collectFormData();
            console.log('Êèê‰∫§ÁöÑË°®ÂçïÊï∞ÊçÆÔºö', formData);
            
            if (confirm('Á°ÆÂÆöË¶ÅÊèê‰∫§Ë∞ÉÂ∫¶‰ªªÂä°ÂêóÔºü')) {
                // ËøôÈáåÂèØ‰ª•ÂèëÈÄÅÊï∞ÊçÆÂà∞ÂêéÁ´Ø
                alert('Ë∞ÉÂ∫¶‰ªªÂä°ÂàõÂª∫ÊàêÂäüÔºÅ');
                window.location.href = 'physical-resource-scheduling.html';
            }
        }

        // ===== ÈìæË∑ØÊãìÊâëË∞ÉÊï¥ÂäüËÉΩ =====
        
        // Ê∑ªÂä†Êìç‰ΩúÁ±ªÂûãÂùóÔºàÊãìÊâëÔºâ
        function addTopologyBlock() {
            const block = {
                id: topologyBlockCounter++,
                operationType: '',
                deviceType: '',
                room: '',
                links: []
            };
            
            topologyBlocks.push(block);
            renderTopologyBlocks();
            updateTopologyStatistics();
        }
        
        // Âà†Èô§Êìç‰ΩúÁ±ªÂûãÂùóÔºàÊãìÊâëÔºâ
        function removeTopologyBlock(blockId) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Êìç‰ΩúÁ±ªÂûãÂùóÂêóÔºüÂ∞ÜÂêåÊó∂Âà†Èô§ÂÖ∂‰∏≠ÁöÑÊâÄÊúâÈìæË∑Ø‰ø°ÊÅØ„ÄÇ')) {
                topologyBlocks = topologyBlocks.filter(block => block.id !== blockId);
                renderTopologyBlocks();
                updateTopologyStatistics();
            }
        }
        
        // Ê∏≤ÊüìÊãìÊâëÊìç‰ΩúÁ±ªÂûãÂùó
        function renderTopologyBlocks() {
            const container = document.getElementById('topologyBlocksContainer');
            
            if (topologyBlocks.length === 0) {
                container.innerHTML = '<p style="color: #6b7280; text-align: center; padding: 40px;">ÊöÇÊó†Êìç‰ΩúÁ±ªÂûãÂùóÔºåËØ∑ÁÇπÂáª‰∏äÊñπÊåâÈíÆÊ∑ªÂä†</p>';
                return;
            }
            
            container.innerHTML = topologyBlocks.map(block => `
                <div class="topology-block" data-block-id="${block.id}">
                    <div class="topology-block-header">
                        <div class="block-title">Êìç‰ΩúÁ±ªÂûãÂùó ${block.id}</div>
                        <div class="block-actions">
                            <button class="btn btn-danger btn-sm" onclick="removeTopologyBlock(${block.id})">Âà†Èô§</button>
                        </div>
                    </div>
                    <div class="operation-block-content">
                        <div class="block-basic-info">
                            <div class="form-group">
                                <label class="form-label">Êìç‰ΩúÁ±ªÂûã <span class="required">*</span></label>
                                <select class="form-select" onchange="updateTopologyBlockOperationType(${block.id}, this.value)">
                                    <option value="">ËØ∑ÈÄâÊã©Êìç‰ΩúÁ±ªÂûã</option>
                                    <option value="ADD" ${block.operationType === 'ADD' ? 'selected' : ''}>Êñ∞Â¢û</option>
                                    <option value="REMOVE" ${block.operationType === 'REMOVE' ? 'selected' : ''}>ÈÄÄËÆ¢</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">ËÆæÂ§áÁ±ªÂûã <span class="required">*</span></label>
                                <select class="form-select" onchange="updateTopologyBlockDeviceType(${block.id}, this.value)">
                                    <option value="">ËØ∑ÈÄâÊã©ËÆæÂ§áÁ±ªÂûã</option>
                                    <option value="server" ${block.deviceType === 'server' ? 'selected' : ''}>ÊúçÂä°Âô®</option>
                                    <option value="network" ${block.deviceType === 'network' ? 'selected' : ''}>ÁΩëÁªúËÆæÂ§á</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Êú∫Êàø <span class="required">*</span></label>
                                <select class="form-select" onchange="updateTopologyBlockRoom(${block.id}, this.value)">
                                    <option value="">ËØ∑ÈÄâÊã©Êú∫Êàø</option>
                                    ${roomOptions.map(room => `<option value="${room}" ${block.room === room ? 'selected' : ''}>${room}</option>`).join('')}
                                </select>
                            </div>
                        </div>
                        
                        <div class="links-section">
                                                    <div class="links-header">
                            <div class="links-count">ÈìæË∑ØÂàóË°® (${block.links.length}/100)</div>
                            <div class="links-actions">

                                <button class="add-link-btn" onclick="addLink(${block.id})" ${block.links.length >= 100 ? 'disabled' : ''}>
                                    <span>+</span>
                                    Ê∑ªÂä†ÈìæË∑Ø
                                </button>
                            </div>
                        </div>
                            
                            ${block.links.length > 0 ? renderLinksTable(block) : '<p style="color: #6b7280; text-align: center; padding: 20px;">ÊöÇÊó†ÈìæË∑ØÔºåËØ∑ÁÇπÂáª"Ê∑ªÂä†ÈìæË∑Ø"ÊåâÈíÆ</p>'}
                            
                            ${block.links.length >= 100 ? '<div class="link-limit-warning">‚ö†Ô∏è Â∑≤ËææÂà∞ÈìæË∑ØÊï∞Èáè‰∏äÈôêÔºà100Êù°Ôºâ</div>' : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Ê∏≤ÊüìÈìæË∑ØÂç°Áâá
        function renderLinksTable(block) {
            return `
                <div class="links-container">
                    ${block.links.map((link, index) => `
                        <div class="link-card">
                            <div class="link-card-header">
                                <div class="link-card-title">ÈìæË∑Ø ${index + 1}</div>
                                <div class="link-card-actions">
                                                                         <button class="expand-edit-btn" onclick="openLinkEditModal(${block.id}, ${index})">ÁºñËæë</button>
                                    <button class="remove-link-btn" onclick="removeLink(${block.id}, ${index})">Âà†Èô§</button>
                                </div>
                            </div>
                            <div class="link-card-body">
                                <!-- ÈìæË∑ØÂü∫Á°Ä‰ø°ÊÅØ -->
                                <div class="link-info-section">
                                    <div class="link-info-header">ÈìæË∑ØÂü∫Á°Ä‰ø°ÊÅØ</div>
                                    <div class="link-info-content">
                                        <div class="link-field">
                                            <label class="link-field-label">ÊâÄÂ±ûÁâ©ÁêÜÈÄöÈÅìÂêçÁß∞ <span class="required">*</span></label>
                                            <input type="text" class="link-input" value="${link.channelName}" 
                                                   onchange="updateLinkField(${block.id}, ${index}, 'channelName', this.value)" 
                                                   placeholder="‰æãÂ¶ÇÔºöÂçé‰∏ú-ÂçéÂåóÈ™®Âπ≤ÈÄöÈÅì">
                                        </div>
                                        
                                        <div class="link-field">
                                            <label class="link-field-label">Â∫îÁî®Á±ªÂûã <span class="required">*</span></label>
                                            <select class="link-select" onchange="updateLinkField(${block.id}, ${index}, 'applicationType', this.value)">
                                                <option value="">ËØ∑ÈÄâÊã©Â∫îÁî®Á±ªÂûã</option>
                                                <option value="CUSTOMER" ${link.applicationType === 'CUSTOMER' ? 'selected' : ''}>‰∏ãËÅîÂÆ¢Êà∑</option>
                                                <option value="ISP" ${link.applicationType === 'ISP' ? 'selected' : ''}>‰∏äËÅîISP</option>
                                                <option value="REMOTE" ${link.applicationType === 'REMOTE' ? 'selected' : ''}>ËøúÁ®ã‰º†Ëæì</option>
                                                <option value="CABINET" ${link.applicationType === 'CABINET' ? 'selected' : ''}>ÊüúÈó¥‰º†Ëæì</option>
                                            </select>
                                        </div>
                                        
                                        <div class="link-field">
                                            <label class="link-field-label">ÈìæË∑ØÁ±ªÂûã <span class="required">*</span></label>
                                            <select class="link-select" onchange="updateLinkField(${block.id}, ${index}, 'linkType', this.value)">
                                                <option value="">ËØ∑ÈÄâÊã©ÈìæË∑ØÁ±ªÂûã</option>
                                                <option value="FIBER" ${link.linkType === 'FIBER' ? 'selected' : ''}>Ë£∏Á∫§</option>
                                                <option value="LEASED" ${link.linkType === 'LEASED' ? 'selected' : ''}>‰∏ìÁ∫ø</option>
                                                <option value="PATCH" ${link.linkType === 'PATCH' ? 'selected' : ''}>Ë∑≥Á∫§</option>
                                            </select>
                                        </div>
                                        
                                        <div class="link-field">
                                            <label class="link-field-label">‰æõÂ∫îÂïÜ</label>
                                            <input type="text" class="link-input" value="${link.supplier}" 
                                                   onchange="updateLinkField(${block.id}, ${index}, 'supplier', this.value)" 
                                                   placeholder="‰æãÂ¶ÇÔºö‰∏≠ÂõΩÁîµ‰ø°„ÄÅAWS">
                                        </div>
                                        
                                        <div class="link-field">
                                            <label class="link-field-label">Êõ¥Â§öÈÖçÁΩÆ</label>
                                            <button class="extra-config-btn" style="width: 100%;" onclick="openExtraConfigModal(${block.id}, ${index})">Êâ©Â±ïÈÖçÁΩÆ</button>
                                        </div>
                                        

                                    </div>
                                </div>
                                
                                <!-- AÁ´ØËÆæÂ§á‰ø°ÊÅØ -->
                                <div class="link-info-section">
                                    <div class="link-info-header">AÁ´ØËÆæÂ§á‰ø°ÊÅØ</div>
                                    <div class="link-info-content">
                                        <div class="link-field">
                                            <label class="link-field-label">ËÆæÂ§áÁºñÁ†Å <span class="required">*</span></label>
                                            <input type="text" class="link-input" value="${link.aEnd.deviceCode}" 
                                                   onchange="updateLinkEndField(${block.id}, ${index}, 'aEnd', 'deviceCode', this.value)" 
                                                   placeholder="Â¶ÇÔºöSW01-NYC-001">
                                        </div>
                                        
                                        <div class="link-field">
                                            <label class="link-field-label">Á´ØÂè£Âè∑</label>
                                            <input type="text" class="link-input" value="${link.aEnd.portNumber}" 
                                                   onchange="updateLinkEndField(${block.id}, ${index}, 'aEnd', 'portNumber', this.value)" 
                                                   placeholder="Â¶ÇÔºöGi1/0/1">
                                        </div>
                                        
                                        <div class="link-field">
                                            <label class="link-field-label">Á´ØÂè£Ê®°Âùó</label>
                                            <input type="text" class="link-input" value="${link.aEnd.portModule}" 
                                                   onchange="updateLinkEndField(${block.id}, ${index}, 'aEnd', 'portModule', this.value)" 
                                                   placeholder="Â¶ÇÔºöSFP-10G-SR">
                                        </div>
                                        
                                        <div class="link-field">
                                            <label class="link-field-label">ÊòØÂê¶‰∏äËÅîPPÊû∂</label>
                                            <select class="link-select" onchange="updateLinkEndField(${block.id}, ${index}, 'aEnd', 'isPpFrame', this.value)">
                                                <option value="false" ${link.aEnd.isPpFrame === false ? 'selected' : ''}>Âê¶</option>
                                                <option value="true" ${link.aEnd.isPpFrame === true ? 'selected' : ''}>ÊòØ</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ZÁ´ØËÆæÂ§á‰ø°ÊÅØ -->
                                <div class="link-info-section">
                                    <div class="link-info-header">ZÁ´ØËÆæÂ§á‰ø°ÊÅØ</div>
                                    <div class="link-info-content">
                                        <div class="link-field">
                                            <label class="link-field-label">ËÆæÂ§áÁºñÁ†Å <span class="required">*</span></label>
                                            <input type="text" class="link-input" value="${link.zEnd.deviceCode}" 
                                                   onchange="updateLinkEndField(${block.id}, ${index}, 'zEnd', 'deviceCode', this.value)" 
                                                   placeholder="Â¶ÇÔºöSW01-DC1-001">
                                        </div>
                                        
                                        <div class="link-field">
                                            <label class="link-field-label">Á´ØÂè£Âè∑</label>
                                            <input type="text" class="link-input" value="${link.zEnd.portNumber}" 
                                                   onchange="updateLinkEndField(${block.id}, ${index}, 'zEnd', 'portNumber', this.value)" 
                                                   placeholder="Â¶ÇÔºöGi1/0/1">
                                        </div>
                                        
                                        <div class="link-field">
                                            <label class="link-field-label">Á´ØÂè£Ê®°Âùó</label>
                                            <input type="text" class="link-input" value="${link.zEnd.portModule}" 
                                                   onchange="updateLinkEndField(${block.id}, ${index}, 'zEnd', 'portModule', this.value)" 
                                                   placeholder="Â¶ÇÔºöSFP-10G-SR">
                                        </div>
                                        
                                        <div class="link-field">
                                            <label class="link-field-label">ÊòØÂê¶‰∏äËÅîPPÊû∂</label>
                                            <select class="link-select" onchange="updateLinkEndField(${block.id}, ${index}, 'zEnd', 'isPpFrame', this.value)">
                                                <option value="false" ${link.zEnd.isPpFrame === false ? 'selected' : ''}>Âê¶</option>
                                                <option value="true" ${link.zEnd.isPpFrame === true ? 'selected' : ''}>ÊòØ</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        // Êõ¥Êñ∞ÊãìÊâëÁªüËÆ°‰ø°ÊÅØ
        function updateTopologyStatistics() {
            document.getElementById('totalTopologyBlocks').textContent = topologyBlocks.length;
            const totalLinks = topologyBlocks.reduce((sum, block) => sum + block.links.length, 0);
            document.getElementById('totalLinks').textContent = totalLinks;
        }
        
        // Êõ¥Êñ∞ÊãìÊâëÂùóÊìç‰ΩúÁ±ªÂûã
        function updateTopologyBlockOperationType(blockId, value) {
            const block = topologyBlocks.find(b => b.id === blockId);
            if (block) {
                block.operationType = value;
            }
        }
        
        // Êõ¥Êñ∞ÊãìÊâëÂùóËÆæÂ§áÁ±ªÂûã
        function updateTopologyBlockDeviceType(blockId, value) {
            const block = topologyBlocks.find(b => b.id === blockId);
            if (block) {
                block.deviceType = value;
            }
        }
        
        // Êõ¥Êñ∞ÊãìÊâëÂùóÊú∫Êàø
        function updateTopologyBlockRoom(blockId, value) {
            const block = topologyBlocks.find(b => b.id === blockId);
            if (block) {
                block.room = value;
            }
        }
        
        // Ê∑ªÂä†ÈìæË∑Ø
        function addLink(blockId) {
            const block = topologyBlocks.find(b => b.id === blockId);
            if (block && block.links.length < 100) {
                                 const link = {
                     channelName: '',
                     applicationType: '',
                     linkType: '',
                     supplier: '',
                    extraConfig: {
                        sidCid: '',
                        connectionCode: '',
                        country: 'CN',
                        city: ''
                    },
                                         aEnd: {
                         deviceCode: '',
                         portNumber: '',
                         portModule: '',
                         isPpFrame: false
                     },
                     zEnd: {
                         deviceCode: '',
                         portNumber: '',
                         portModule: '',
                         isPpFrame: false
                     }
                };
                
                block.links.push(link);
                renderTopologyBlocks();
                updateTopologyStatistics();
            }
        }
        
        // Âà†Èô§ÈìæË∑Ø
        function removeLink(blockId, linkIndex) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ÈìæË∑ØÂêóÔºü')) {
                const block = topologyBlocks.find(b => b.id === blockId);
                if (block) {
                    block.links.splice(linkIndex, 1);
                    renderTopologyBlocks();
                    updateTopologyStatistics();
                }
            }
        }
        
        // Êõ¥Êñ∞ÈìæË∑ØÂ≠óÊÆµ
        function updateLinkField(blockId, linkIndex, field, value) {
            const block = topologyBlocks.find(b => b.id === blockId);
            if (block && block.links[linkIndex]) {
                block.links[linkIndex][field] = value;
            }
        }
        
        // Êõ¥Êñ∞ÈìæË∑ØÁ´ØÁÇπÂ≠óÊÆµ
        function updateLinkEndField(blockId, linkIndex, endType, field, value) {
            const block = topologyBlocks.find(b => b.id === blockId);
            if (block && block.links[linkIndex]) {
                if (field === 'isPpFrame') {
                    block.links[linkIndex][endType][field] = value === 'true';
                } else {
                    block.links[linkIndex][endType][field] = value;
                }
            }
        }
        
        // ÊâìÂºÄÊâ©Â±ïÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü
        function openExtraConfigModal(blockId, linkIndex) {
            const block = topologyBlocks.find(b => b.id === blockId);
            if (block && block.links[linkIndex]) {
                currentExtraConfigLink = { blockId, linkIndex };
                const extraConfig = block.links[linkIndex].extraConfig;
                
                document.getElementById('sidCid').value = extraConfig.sidCid || '';
                document.getElementById('connectionCode').value = extraConfig.connectionCode || '';
                document.getElementById('country').value = extraConfig.country || 'CN';
                updateCityOptions();
                document.getElementById('city').value = extraConfig.city || '';
                
                document.getElementById('extraConfigModal').classList.add('show');
            }
        }
        
        // ÂÖ≥Èó≠Êâ©Â±ïÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü
        function closeExtraConfigModal() {
            document.getElementById('extraConfigModal').classList.remove('show');
            currentExtraConfigLink = null;
        }
        
        // ‰øùÂ≠òÊâ©Â±ïÈÖçÁΩÆ
        function saveExtraConfig() {
            if (currentExtraConfigLink) {
                const { blockId, linkIndex } = currentExtraConfigLink;
                const block = topologyBlocks.find(b => b.id === blockId);
                
                if (block && block.links[linkIndex]) {
                    block.links[linkIndex].extraConfig = {
                        sidCid: document.getElementById('sidCid').value,
                        connectionCode: document.getElementById('connectionCode').value,
                        country: document.getElementById('country').value,
                        city: document.getElementById('city').value
                    };
                }
                
                closeExtraConfigModal();
                alert('Êâ©Â±ïÈÖçÁΩÆ‰øùÂ≠òÊàêÂäüÔºÅ');
            }
        }
        
                 // Êõ¥Êñ∞ÂüéÂ∏ÇÈÄâÈ°π
         function updateCityOptions() {
             const country = document.getElementById('country').value;
             const citySelect = document.getElementById('city');
             
             citySelect.innerHTML = '<option value="">ËØ∑ÈÄâÊã©ÂüéÂ∏Ç</option>';
             
             if (cityOptions[country]) {
                 cityOptions[country].forEach(city => {
                     const option = document.createElement('option');
                     option.value = city;
                     option.textContent = city;
                     citySelect.appendChild(option);
                 });
             }
         }

         // Êâ©Â±ïÈÖçÁΩÆÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÁÇπÂáªÂÖ≥Èó≠
         document.addEventListener('click', function(e) {
             const modal = document.getElementById('extraConfigModal');
             if (e.target === modal) {
                 closeExtraConfigModal();
             }
         });

         // ===== ÈìæË∑ØÁºñËæëÂºπÁ™óÂäüËÉΩ =====
         
         // ÊâìÂºÄÈìæË∑ØÁºñËæëÂºπÁ™ó
         function openLinkEditModal(blockId, linkIndex) {
             const block = topologyBlocks.find(b => b.id === blockId);
             if (block && block.links[linkIndex]) {
                 currentEditingLink = { blockId, linkIndex };
                 const link = block.links[linkIndex];
                 
                 // Â°´ÂÖÖAÁ´ØÊï∞ÊçÆ
                 document.getElementById('editADeviceCode').value = link.aEnd.deviceCode || '';
                 document.getElementById('editAPortNumber').value = link.aEnd.portNumber || '';
                 document.getElementById('editAPortModule').value = link.aEnd.portModule || '';
                 
                 const aIsPpFrame = link.aEnd.isPpFrame ? 'true' : 'false';
                 document.querySelector(`input[name="editAIsPpFrame"][value="${aIsPpFrame}"]`).checked = true;
                 
                 // Â°´ÂÖÖZÁ´ØÊï∞ÊçÆ
                 document.getElementById('editZDeviceCode').value = link.zEnd.deviceCode || '';
                 document.getElementById('editZPortNumber').value = link.zEnd.portNumber || '';
                 document.getElementById('editZPortModule').value = link.zEnd.portModule || '';
                 
                 const zIsPpFrame = link.zEnd.isPpFrame ? 'true' : 'false';
                 document.querySelector(`input[name="editZIsPpFrame"][value="${zIsPpFrame}"]`).checked = true;
                 
                 // Ê∏ÖÁ©∫‰∏≠ÁªßËÆæÂ§á
                 document.getElementById('relayDevicesContainer').innerHTML = '';
                 relayDeviceCounter = 1;
                 
                 // Ê∏ÖÁ©∫ÈîôËØØ‰ø°ÊÅØ
                 clearLinkEditErrors();
                 
                 // ÊòæÁ§∫ÂºπÁ™ó
                 document.getElementById('linkEditModal').classList.add('show');
             }
         }
         
         // ÂÖ≥Èó≠ÈìæË∑ØÁºñËæëÂºπÁ™ó
         function closeLinkEditModal() {
             document.getElementById('linkEditModal').classList.remove('show');
             currentEditingLink = null;
         }
         
         // Ê∑ªÂä†‰∏≠ÁªßËÆæÂ§á
         function addRelayDevice() {
             const container = document.getElementById('relayDevicesContainer');
             const relayId = relayDeviceCounter++;
             
             const relayHtml = `
                 <div class="relay-device" data-relay-id="${relayId}">
                     <div class="relay-device-header">
                         <div class="relay-device-title">‰∏≠Áªß ${relayId}</div>
                         <button class="remove-relay-btn" onclick="removeRelayDevice(${relayId})">Âà†Èô§</button>
                     </div>
                     <div class="relay-device-content">
                         <div class="relay-device-field">
                             <label class="relay-device-label">ËÆæÂ§áÁ±ªÂûã</label>
                             <div class="relay-radio-group">
                                 <label class="relay-radio-option">
                                     <input type="radio" name="relayDeviceType${relayId}" value="optical">
                                     <span class="relay-radio-text">Ê≥¢ÂàÜËÆæÂ§á</span>
                                 </label>
                                 <label class="relay-radio-option">
                                     <input type="radio" name="relayDeviceType${relayId}" value="third-party" checked>
                                     <span class="relay-radio-text">Á¨¨‰∏âÊñπËÆæÂ§á</span>
                                 </label>
                             </div>
                         </div>
                     </div>
                 </div>
             `;
             
             container.insertAdjacentHTML('beforeend', relayHtml);
         }
         
         // Âà†Èô§‰∏≠ÁªßËÆæÂ§á
         function removeRelayDevice(relayId) {
             const relayElement = document.querySelector(`[data-relay-id="${relayId}"]`);
             if (relayElement) {
                 relayElement.remove();
             }
         }
         
         // Ê∏ÖÁ©∫ÈîôËØØ‰ø°ÊÅØ
         function clearLinkEditErrors() {
             const errorElements = document.querySelectorAll('#linkEditModal .field-error');
             errorElements.forEach(element => {
                 element.textContent = '';
             });
         }
         
         // È™åËØÅÈìæË∑ØÁºñËæëË°®Âçï
         function validateLinkEdit() {
             clearLinkEditErrors();
             let isValid = true;
             
             // È™åËØÅAÁ´ØËÆæÂ§áÁºñÁ†Å
             const aDeviceCode = document.getElementById('editADeviceCode').value.trim();
             if (!aDeviceCode) {
                 document.getElementById('editADeviceCodeError').textContent = 'ËØ∑ËæìÂÖ•AÁ´ØËÆæÂ§áÁºñÁ†Å';
                 isValid = false;
             }
             
             // È™åËØÅZÁ´ØËÆæÂ§áÁºñÁ†Å
             const zDeviceCode = document.getElementById('editZDeviceCode').value.trim();
             if (!zDeviceCode) {
                 document.getElementById('editZDeviceCodeError').textContent = 'ËØ∑ËæìÂÖ•ZÁ´ØËÆæÂ§áÁºñÁ†Å';
                 isValid = false;
             }
             
             return isValid;
         }
         
         // ‰øùÂ≠òÈìæË∑ØÁºñËæë
         function saveLinkEdit() {
             if (!validateLinkEdit()) {
                 return;
             }
             
             if (currentEditingLink) {
                 const { blockId, linkIndex } = currentEditingLink;
                 const block = topologyBlocks.find(b => b.id === blockId);
                 
                 if (block && block.links[linkIndex]) {
                     // Êõ¥Êñ∞AÁ´ØÊï∞ÊçÆ
                     block.links[linkIndex].aEnd.deviceCode = document.getElementById('editADeviceCode').value.trim();
                     block.links[linkIndex].aEnd.portNumber = document.getElementById('editAPortNumber').value.trim();
                     block.links[linkIndex].aEnd.portModule = document.getElementById('editAPortModule').value.trim();
                     block.links[linkIndex].aEnd.isPpFrame = document.querySelector('input[name="editAIsPpFrame"]:checked').value === 'true';
                     
                     // Êõ¥Êñ∞ZÁ´ØÊï∞ÊçÆ
                     block.links[linkIndex].zEnd.deviceCode = document.getElementById('editZDeviceCode').value.trim();
                     block.links[linkIndex].zEnd.portNumber = document.getElementById('editZPortNumber').value.trim();
                     block.links[linkIndex].zEnd.portModule = document.getElementById('editZPortModule').value.trim();
                     block.links[linkIndex].zEnd.isPpFrame = document.querySelector('input[name="editZIsPpFrame"]:checked').value === 'true';
                     
                     // Êî∂ÈõÜ‰∏≠ÁªßËÆæÂ§áÊï∞ÊçÆ
                     const relayDevices = [];
                     const relayElements = document.querySelectorAll('.relay-device');
                     relayElements.forEach(element => {
                         const relayId = element.getAttribute('data-relay-id');
                         const deviceType = document.querySelector(`input[name="relayDeviceType${relayId}"]:checked`).value;
                         relayDevices.push({
                             id: relayId,
                             deviceType: deviceType
                         });
                     });
                     
                     // ‰øùÂ≠ò‰∏≠ÁªßËÆæÂ§áÊï∞ÊçÆ
                     block.links[linkIndex].relayDevices = relayDevices;
                     
                     // ÈáçÊñ∞Ê∏≤Êüì
                     renderTopologyBlocks();
                     
                     // ÂÖ≥Èó≠ÂºπÁ™ó
                     closeLinkEditModal();
                     
                     alert('ÈìæË∑Ø‰ø°ÊÅØ‰øùÂ≠òÊàêÂäüÔºÅ');
                 }
             }
         }
         
         // ÁõëÂê¨ÈìæË∑ØÁºñËæëÂºπÁ™óÂ§ñÈÉ®ÁÇπÂáªÔºà‰∏çÂÖ≥Èó≠ÂºπÁ™óÔºåÊåâË¶ÅÊ±ÇÈúÄË¶ÅÁÇπÂáªÂèñÊ∂àÊàñXÊåâÈíÆÔºâ
         document.getElementById('linkEditModal').addEventListener('click', function(e) {
             // ÁÇπÂáªÈÅÆÁΩ©‰∏çÂÖ≥Èó≠ÂºπÁ™óÔºåÊåâÁÖßË¶ÅÊ±Ç
         });

         

                 // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
         

                    // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠Ëß£ÊûêÊ®°ÊÄÅÊ°Ü
           document.getElementById('parseModal').addEventListener('click', function(e) {
               if (e.target === this) {
                   closeParseModal();
               }
           });

           // ===== ËÆæÂ§áË∞ÉÂ∫¶ÁÆ°ÁêÜÂäüËÉΩ =====
         
         // Ê∑ªÂä†Êìç‰ΩúÁ±ªÂûãÂùó
         function addOperationBlock() {
             const block = {
                 id: blockCounter++,
                 operationType: '',
                 deviceType: '',
                 room: '',
                 devices: []
             };
             
             operationBlocks.push(block);
             renderOperationBlocks();
             updateBlocksStatistics();
         }
         
         // Âà†Èô§Êìç‰ΩúÁ±ªÂûãÂùó
         function removeOperationBlock(blockId) {
             if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Êìç‰ΩúÁ±ªÂûãÂùóÂêóÔºüÂ∞ÜÂêåÊó∂Âà†Èô§ÂÖ∂‰∏≠ÁöÑÊâÄÊúâËÆæÂ§á‰ø°ÊÅØ„ÄÇ')) {
                 operationBlocks = operationBlocks.filter(block => block.id !== blockId);
                 renderOperationBlocks();
                 updateBlocksStatistics();
             }
         }
         
         // Ê∏≤ÊüìÊìç‰ΩúÁ±ªÂûãÂùó
         function renderOperationBlocks() {
             const container = document.getElementById('operationBlocksContainer');
             
             if (operationBlocks.length === 0) {
                 container.innerHTML = '<p style="color: #6b7280; text-align: center; padding: 40px;">ÊöÇÊó†Êìç‰ΩúÁ±ªÂûãÂùóÔºåËØ∑ÁÇπÂáª‰∏äÊñπÊåâÈíÆÊ∑ªÂä†</p>';
                 return;
             }
             
             container.innerHTML = operationBlocks.map(block => `
                 <div class="operation-block" data-block-id="${block.id}">
                     <div class="operation-block-header">
                         <div class="block-title">Êìç‰ΩúÁ±ªÂûãÂùó ${block.id}</div>
                         <div class="block-actions">

                             <button class="btn btn-danger btn-sm" onclick="removeOperationBlock(${block.id})">Âà†Èô§</button>
                         </div>
                     </div>
                     <div class="operation-block-content">
                         <div class="block-basic-info">
                             <div class="form-group">
                                 <label class="form-label">Êìç‰ΩúÁ±ªÂûã <span class="required">*</span></label>
                                 <select class="form-select" onchange="updateBlockOperationType(${block.id}, this.value)">
                                     <option value="">ËØ∑ÈÄâÊã©Êìç‰ΩúÁ±ªÂûã</option>
                                     <option value="UP" ${block.operationType === 'UP' ? 'selected' : ''}>‰∏äÊû∂</option>
                                     <option value="DOWN" ${block.operationType === 'DOWN' ? 'selected' : ''}>‰∏ãÊû∂</option>
                                 </select>
                             </div>
                             
                             <div class="form-group">
                                 <label class="form-label">ËÆæÂ§áÁ±ªÂûã <span class="required">*</span></label>
                                 <select class="form-select" onchange="updateBlockDeviceType(${block.id}, this.value)">
                                     <option value="">ËØ∑ÈÄâÊã©ËÆæÂ§áÁ±ªÂûã</option>
                                     <option value="server" ${block.deviceType === 'server' ? 'selected' : ''}>ÊúçÂä°Âô®</option>
                                     <option value="network" ${block.deviceType === 'network' ? 'selected' : ''}>ÁΩëÁªúËÆæÂ§á</option>
                                 </select>
                             </div>
                             
                             <div class="form-group">
                                 <label class="form-label">Êú∫Êàø <span class="required">*</span></label>
                                 <select class="form-select" onchange="updateBlockRoom(${block.id}, this.value)">
                                     <option value="">ËØ∑ÈÄâÊã©Êú∫Êàø</option>
                                     ${roomOptions.map(room => `<option value="${room}" ${block.room === room ? 'selected' : ''}>${room}</option>`).join('')}
                                 </select>
                             </div>
                         </div>
                         
                         <div class="devices-section">
                             <div class="devices-header">
                                 <div class="devices-count">ËÆæÂ§áÂàóË°® (${block.devices.length}/50)</div>
                                 <button class="add-device-btn" onclick="addDevice(${block.id})" ${block.devices.length >= 50 ? 'disabled' : ''}>
                                     <span>+</span>
                                     Ê∑ªÂä†ËÆæÂ§á
                                 </button>
                             </div>
                             
                             ${block.devices.length > 0 ? renderDevicesTable(block) : '<p style="color: #6b7280; text-align: center; padding: 20px;">ÊöÇÊó†ËÆæÂ§áÔºåËØ∑ÁÇπÂáª"Ê∑ªÂä†ËÆæÂ§á"ÊåâÈíÆ</p>'}
                             
                             ${block.devices.length >= 50 ? '<div class="device-limit-warning">‚ö†Ô∏è Â∑≤ËææÂà∞ËÆæÂ§áÊï∞Èáè‰∏äÈôêÔºà50Âè∞Ôºâ</div>' : ''}
                         </div>
                     </div>
                 </div>
             `).join('');
         }
         
         // Ê∏≤ÊüìËÆæÂ§áË°®Ê†º
         function renderDevicesTable(block) {
             return `
                 <div class="devices-table">
                     <table>
                                                   <thead>
                              <tr>
                                  <th>ËµÑ‰∫ßÁºñÂè∑</th>
                                  <th>SNÁ†Å</th>
                                  <th>ÂûãÂè∑ÂêçÁß∞</th>
                                  <th>Êú∫Êüú</th>
                                  <th>U‰Ωç‰ΩçÁΩÆ</th>
                                  <th>‰ΩøÁî®ÂÖ¨Âè∏</th>
                                  <th>ÂÜÖÁΩëIP</th>
                                  <th>ÂÖ¨ÁΩëIP</th>
                                  <th>SNMPÂõ¢‰ΩìÂêç</th>
                                  <th>Êìç‰Ωú</th>
                              </tr>
                          </thead>
                         <tbody>
                             ${block.devices.map((device, index) => `
                                 <tr>
                                     <td>
                                         <input type="text" class="device-input" value="${device.assetId}" 
                                                onchange="updateDeviceField(${block.id}, ${index}, 'assetId', this.value)"
                                                onblur="autoFillDeviceInfo(${block.id}, ${index}, this.value)"
                                                placeholder="ËæìÂÖ•ËµÑ‰∫ßÁºñÂè∑">
                                     </td>
                                     <td>
                                         <input type="text" class="device-input auto-filled" value="${device.sn}" readonly 
                                                title="ÈÄöËøáËµÑ‰∫ßÁºñÂè∑Ëá™Âä®Â°´ÂÖÖ">
                                     </td>
                                     <td>
                                         <input type="text" class="device-input auto-filled" value="${device.model}" readonly 
                                                title="ÈÄöËøáËµÑ‰∫ßÁºñÂè∑Ëá™Âä®Â°´ÂÖÖ">
                                     </td>
                                     <td>
                                         <select class="device-select" onchange="updateDeviceField(${block.id}, ${index}, 'cabinet', this.value)">
                                             <option value="">ÈÄâÊã©Êú∫Êüú</option>
                                             ${cabinetOptions.map(cab => `<option value="${cab}" ${device.cabinet === cab ? 'selected' : ''}>${cab}</option>`).join('')}
                                         </select>
                                     </td>
                                     <td>
                                         <div class="u-position-group">
                                             <select class="device-select" onchange="updateDeviceField(${block.id}, ${index}, 'startU', this.value); autoFillEndU(${block.id}, ${index})">
                                                 <option value="">Ëµ∑ÂßãU</option>
                                                 ${Array.from({length: 42}, (_, i) => i + 1).map(u => `<option value="${u}" ${device.startU === u ? 'selected' : ''}>U${u}</option>`).join('')}
                                             </select>
                                             <span>-</span>
                                             <select class="device-select" onchange="updateDeviceField(${block.id}, ${index}, 'endU', this.value)">
                                                 <option value="">ÁªìÊùüU</option>
                                                 ${Array.from({length: 42}, (_, i) => i + 1).map(u => `<option value="${u}" ${device.endU === u ? 'selected' : ''}>U${u}</option>`).join('')}
                                             </select>
                                         </div>
                                     </td>
                                     <td>
                                         <select class="device-select" onchange="updateDeviceField(${block.id}, ${index}, 'ownerCompany', this.value)">
                                             <option value="">ÈÄâÊã©ÂÖ¨Âè∏</option>
                                             ${companyOptions.map(company => `<option value="${company}" ${device.ownerCompany === company ? 'selected' : ''}>${company}</option>`).join('')}
                                         </select>
                                     </td>
                                     <td>
                                         <input type="text" class="device-input" value="${device.privateIp}" 
                                                onchange="updateDeviceField(${block.id}, ${index}, 'privateIp', this.value)"
                                                onblur="validateIPAddress(this)"
                                                placeholder="192.168.1.1">
                                     </td>
                                     <td>
                                         <input type="text" class="device-input" value="${device.publicIp}" 
                                                onchange="updateDeviceField(${block.id}, ${index}, 'publicIp', this.value)"
                                                onblur="validateIPAddress(this)"
                                                placeholder="1.2.3.4">
                                     </td>
                                                                           <td>
                                          <input type="text" class="device-input" value="${device.snmpCommunity}" 
                                                 onchange="updateDeviceField(${block.id}, ${index}, 'snmpCommunity', this.value)"
                                                 placeholder="public@123">
                                      </td>
                                      <td>
                                          <button class="remove-device-btn" onclick="removeDevice(${block.id}, ${index})">Âà†Èô§</button>
                                      </td>
                                 </tr>
                             `).join('')}
                         </tbody>
                     </table>
                 </div>
             `;
         }
         
         // Êõ¥Êñ∞Êìç‰ΩúÁ±ªÂûãÂùóÂ≠óÊÆµ
         function updateBlockOperationType(blockId, value) {
             const block = operationBlocks.find(b => b.id === blockId);
             if (block) {
                 block.operationType = value;
             }
         }
         
         function updateBlockDeviceType(blockId, value) {
             const block = operationBlocks.find(b => b.id === blockId);
             if (block) {
                 block.deviceType = value;
             }
         }
         
         function updateBlockRoom(blockId, value) {
             const block = operationBlocks.find(b => b.id === blockId);
             if (block) {
                 block.room = value;
             }
         }
         
         // ËÆæÂ§áÁÆ°ÁêÜ
         function addDevice(blockId) {
             const block = operationBlocks.find(b => b.id === blockId);
             if (block && block.devices.length < 50) {
                 const device = {
                     assetId: '',
                     sn: '',
                     model: '',
                     cabinet: '',
                     startU: '',
                     endU: '',
                     ownerCompany: '',
                     privateIp: '',
                     publicIp: '',
                     snmpCommunity: ''
                 };
                 
                 block.devices.push(device);
                 renderOperationBlocks();
                 updateBlocksStatistics();
             }
         }
         
         function removeDevice(blockId, deviceIndex) {
             const block = operationBlocks.find(b => b.id === blockId);
             if (block && confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÂè∞ËÆæÂ§áÂêóÔºü')) {
                 block.devices.splice(deviceIndex, 1);
                 renderOperationBlocks();
                 updateBlocksStatistics();
             }
         }
         
         function updateDeviceField(blockId, deviceIndex, field, value) {
             const block = operationBlocks.find(b => b.id === blockId);
             if (block && block.devices[deviceIndex]) {
                 block.devices[deviceIndex][field] = value;
             }
         }
         
         // Ëá™Âä®Â°´ÂÖÖËÆæÂ§á‰ø°ÊÅØ
         function autoFillDeviceInfo(blockId, deviceIndex, assetId) {
             const block = operationBlocks.find(b => b.id === blockId);
             if (block && block.devices[deviceIndex]) {
                 const device = block.devices[deviceIndex];
                 
                 // Ê∏ÖÁ©∫‰πãÂâçÁöÑËá™Âä®Â°´ÂÖÖÊï∞ÊçÆ
                 device.sn = '';
                 device.model = '';
                 
                 if (assetId && assetId.trim()) {
                     // ÊîØÊåÅÂ§ßÂ∞èÂÜô‰∏çÊïèÊÑüÁöÑÂåπÈÖç
                     const normalizedAssetId = assetId.trim().toUpperCase();
                     const mockData = mockAssetData[normalizedAssetId];
                     
                     if (mockData) {
                         // ÊâæÂà∞ÂåπÈÖçÊï∞ÊçÆÔºåËá™Âä®Â°´ÂÖÖ
                         device.sn = mockData.sn;
                         device.model = mockData.model;
                         
                         // ÊòæÁ§∫ÊàêÂäüÊèêÁ§∫ÔºàÂèØÈÄâÔºâ
                         console.log(`ËµÑ‰∫ßÁºñÂè∑ ${assetId} Ëá™Âä®Â°´ÂÖÖÂÆåÊàê: SN=${mockData.sn}, ÂûãÂè∑=${mockData.model}`);
                     } else {
                         // Êú™ÊâæÂà∞ÂåπÈÖçÊï∞ÊçÆÔºåÁªôÂá∫ÊèêÁ§∫
                         console.log(`Êú™ÊâæÂà∞ËµÑ‰∫ßÁºñÂè∑ ${assetId} ÂØπÂ∫îÁöÑËÆæÂ§á‰ø°ÊÅØÔºåËØ∑ÊâãÂä®Â°´ÂÜôSNÁ†ÅÂíåÂûãÂè∑`);
                     }
                 }
                 
                 // ÈáçÊñ∞Ê∏≤ÊüìËÆæÂ§áË°®Ê†º
                 renderOperationBlocks();
             }
         }
         
         // Ëá™Âä®Â°´ÂÖÖÁªìÊùüU‰Ωç
         function autoFillEndU(blockId, deviceIndex) {
             const block = operationBlocks.find(b => b.id === blockId);
             if (block && block.devices[deviceIndex]) {
                 const device = block.devices[deviceIndex];
                 if (device.startU && !device.endU) {
                     device.endU = device.startU;
                     renderOperationBlocks();
                 }
             }
         }
         
         
         
         // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
         function updateBlocksStatistics() {
             const totalBlocks = operationBlocks.length;
             const totalDevices = operationBlocks.reduce((sum, block) => sum + block.devices.length, 0);
             
             document.getElementById('totalBlocks').textContent = totalBlocks;
             document.getElementById('totalDevices').textContent = totalDevices;
         }
         
         // IPÂú∞ÂùÄÈ™åËØÅ
         function isValidIP(ip) {
             // IPv4È™åËØÅ
             const ipv4Regex = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
             // IPv6È™åËØÅÔºàÁÆÄÂåñÁâàÔºâ
             const ipv6Regex = /^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/;
             
             return ipv4Regex.test(ip) || ipv6Regex.test(ip);
         }
         
         function validateIPAddress(input) {
             const ip = input.value.trim();
             if (ip && !isValidIP(ip)) {
                 input.classList.add('validation-error');
                 // Ê∑ªÂä†ÈîôËØØÊèêÁ§∫
                 let errorMsg = input.nextElementSibling;
                 if (!errorMsg || !errorMsg.classList.contains('validation-message')) {
                     errorMsg = document.createElement('div');
                     errorMsg.className = 'validation-message';
                     input.parentNode.appendChild(errorMsg);
                 }
                 errorMsg.textContent = 'ËØ∑ËæìÂÖ•Ê≠£Á°ÆÁöÑIPÂú∞ÂùÄÊ†ºÂºè';
             } else {
                 input.classList.remove('validation-error');
                 // ÁßªÈô§ÈîôËØØÊèêÁ§∫
                 const errorMsg = input.nextElementSibling;
                 if (errorMsg && errorMsg.classList.contains('validation-message')) {
                     errorMsg.remove();
                 }
             }
         }
    </script>
</body>
</html> 